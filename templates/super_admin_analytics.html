
{% extends "base.html" %}

{% block content %}
<div class="analytics-container">
    <h1>üìä Advanced Analytics Dashboard</h1>
    
    <!-- KPI Cards -->
    <div class="kpi-grid">
        <div class="kpi-card">
            <h3>üí∞ Bugungi Daromad</h3>
            <div class="kpi-value" id="today-revenue">0 so'm</div>
            <div class="kpi-change positive" id="revenue-change">+12.5%</div>
        </div>
        
        <div class="kpi-card">
            <h3>üì¶ Bugungi Buyurtmalar</h3>
            <div class="kpi-value" id="today-orders">0</div>
            <div class="kpi-change positive" id="orders-change">+8.3%</div>
        </div>
        
        <div class="kpi-card">
            <h3>üë• Faol Foydalanuvchilar</h3>
            <div class="kpi-value" id="active-users">0</div>
            <div class="kpi-change neutral" id="users-change">+2.1%</div>
        </div>
        
        <div class="kpi-card">
            <h3>‚≠ê O'rtacha Baho</h3>
            <div class="kpi-value" id="avg-rating">4.5</div>
            <div class="kpi-change positive" id="rating-change">+0.2</div>
        </div>
    </div>
    
    <!-- Charts Section -->
    <div class="charts-section">
        <div class="chart-container">
            <h3>üìà Daromad Trendi (30 kun)</h3>
            <canvas id="revenueChart"></canvas>
        </div>
        
        <div class="chart-container">
            <h3>üçΩÔ∏è Top Mahsulotlar</h3>
            <canvas id="productsChart"></canvas>
        </div>
    </div>
    
    <!-- Real-time Activity -->
    <div class="activity-section">
        <h3>üî¥ Real-time Faollik</h3>
        <div id="real-time-feed" class="activity-feed">
            <!-- Real-time updates will be inserted here -->
        </div>
    </div>
</div>

<style>
.analytics-container {
    padding: 20px;
    max-width: 1400px;
    margin: 0 auto;
}

.kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.kpi-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 25px;
    border-radius: 15px;
    text-align: center;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.kpi-value {
    font-size: 2.5rem;
    font-weight: bold;
    margin: 10px 0;
}

.kpi-change {
    font-size: 1.1rem;
    font-weight: 500;
}

.kpi-change.positive { color: #4ade80; }
.kpi-change.negative { color: #f87171; }
.kpi-change.neutral { color: #fbbf24; }

.charts-section {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 30px;
    margin-bottom: 30px;
}

.chart-container {
    background: white;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.activity-section {
    background: white;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.activity-feed {
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 15px;
}

.activity-item {
    padding: 10px;
    border-bottom: 1px solid #f3f4f6;
    display: flex;
    align-items: center;
    gap: 10px;
}

.activity-time {
    color: #6b7280;
    font-size: 0.875rem;
}
</style>

<script>
// Real-time updates
function startRealTimeUpdates() {
    setInterval(() => {
        updateKPIs();
        updateRealTimeFeed();
    }, 30000); // Har 30 soniyada yangilash
}

function updateKPIs() {
    fetch('/api/super-admin/kpis')
        .then(response => response.json())
        .then(data => {
            document.getElementById('today-revenue').textContent = data.revenue.toLocaleString() + ' so\'m';
            document.getElementById('today-orders').textContent = data.orders;
            document.getElementById('active-users').textContent = data.activeUsers;
            document.getElementById('avg-rating').textContent = data.avgRating;
        })
        .catch(error => console.error('KPI update error:', error));
}

function updateRealTimeFeed() {
    fetch('/api/super-admin/activity-feed')
        .then(response => response.json())
        .then(data => {
            const feed = document.getElementById('real-time-feed');
            feed.innerHTML = '';
            
            data.activities.forEach(activity => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                item.innerHTML = `
                    <span class="activity-icon">${activity.icon}</span>
                    <span class="activity-text">${activity.text}</span>
                    <span class="activity-time">${activity.time}</span>
                `;
                feed.appendChild(item);
            });
        })
        .catch(error => console.error('Activity feed error:', error));
}

// Initialize charts and real-time updates when page loads
document.addEventListener('DOMContentLoaded', function() {
    startRealTimeUpdates();
    updateKPIs();
    updateRealTimeFeed();
});
</script>
{% endblock %}
