
{% extends "base.html" %}

{% block title %}Umumi sozlamalar{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3>üîß Umumi sozlamalar</h3>
                    <p class="mb-0 text-muted">Interfeys va ko'rinish sozlamalari</p>
                </div>
                <div class="card-body">
                    <!-- Til sozlamalari -->
                    <div class="settings-section">
                        <h5>üåê Til sozlamalari</h5>
                        <div class="row">
                            <div class="col-md-12">
                                <label for="languageSelect" class="form-label">Interface tili:</label>
                                <select class="form-select" id="languageSelect" onchange="changeLanguage(this.value)">
                                    <option value="uz" {{ 'selected' if session.get('interface_language', 'uz') == 'uz' }}>üá∫üáø O'zbekcha</option>
                                    <option value="ru" {{ 'selected' if session.get('interface_language', 'uz') == 'ru' }}>üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                                    <option value="en" {{ 'selected' if session.get('interface_language', 'uz') == 'en' }}>üá¨üáß English</option>
                                </select>
                                <div class="form-text">Interface tili o'zgarishi darhol qo'llaniladi</div>
                            </div>
                        </div>
                    </div>

                    <hr class="my-4">

                    <!-- Mavzu sozlamalari -->
                    <div class="settings-section">
                        <h5>üé® Ko'rinish sozlamalari</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <label for="themeSelect" class="form-label">Mavzu:</label>
                                <div class="theme-options">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="theme" id="lightTheme" value="light" 
                                               {{ 'checked' if not session.get('dark_theme', False) }} 
                                               onchange="changeTheme(false)">
                                        <label class="form-check-label" for="lightTheme">
                                            ‚òÄÔ∏è Yorug' mavzu
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="theme" id="darkTheme" value="dark" 
                                               {{ 'checked' if session.get('dark_theme', False) }} 
                                               onchange="changeTheme(true)">
                                        <label class="form-check-label" for="darkTheme">
                                            üåô Qora mavzu
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="fontSizeSelect" class="form-label">Shrift o'lchami:</label>
                                <select class="form-select" id="fontSizeSelect" onchange="changeFontSize(this.value)">
                                    <option value="small" {{ 'selected' if session.get('font_size', 'medium') == 'small' }}>üìù Kichik</option>
                                    <option value="medium" {{ 'selected' if session.get('font_size', 'medium') == 'medium' }}>üìÑ O'rtacha</option>
                                    <option value="large" {{ 'selected' if session.get('font_size', 'medium') == 'large' }}>üìã Katta</option>
                                    <option value="xlarge" {{ 'selected' if session.get('font_size', 'medium') == 'xlarge' }}>üìä Juda katta</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <hr class="my-4">

                    <!-- Bildirishnoma sozlamalari -->
                    <div class="settings-section">
                        <h5>üîî Bildirishnoma sozlamalari</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="soundSwitch" checked>
                                    <label class="form-check-label" for="soundSwitch">
                                        üîä Ovozli bildirishnomalar
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="notificationSwitch" checked>
                                    <label class="form-check-label" for="notificationSwitch">
                                        üì± Push bildirishnomalar
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr class="my-4">

                    <!-- Interfeys sozlamalari -->
                    <div class="settings-section">
                        <h5>üéõÔ∏è Interfeys sozlamalari</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="autoRefreshSwitch" checked>
                                    <label class="form-check-label" for="autoRefreshSwitch">
                                        üîÑ Avtomatik yangilanish
                                    </label>
                                </div>
                                <small class="text-muted">Sahifalar avtomatik yangilanadi</small>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="animationsSwitch" checked>
                                    <label class="form-check-label" for="animationsSwitch">
                                        ‚ú® Animatsiyalar
                                    </label>
                                </div>
                                <small class="text-muted">Interface animatsiyalari</small>
                            </div>
                        </div>
                    </div>

                    <hr class="my-4">

                    <!-- Foydalanuvchi uchun qo'shimcha sozlamalar -->
                    {% if session.get('user_id') %}
                    <div class="settings-section">
                        <h5>üõí Xarid sozlamalari</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="saveCartSwitch" checked>
                                    <label class="form-check-label" for="saveCartSwitch">
                                        üíæ Savatchani saqlash
                                    </label>
                                </div>
                                <small class="text-muted">Savatcha mahsulotlarini eslab qolish</small>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="quickOrderSwitch">
                                    <label class="form-check-label" for="quickOrderSwitch">
                                        ‚ö° Tezkor buyurtma
                                    </label>
                                </div>
                                <small class="text-muted">Bir click bilan buyurtma berish</small>
                            </div>
                        </div>
                    </div>

                    <hr class="my-4">
                    {% endif %}

                    <!-- Xavfsizlik sozlamalari -->
                    <div class="settings-section">
                        <h5>üîê Xavfsizlik sozlamalari</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="rememberMeSwitch" checked>
                                    <label class="form-check-label" for="rememberMeSwitch">
                                        üß† Meni eslab qol
                                    </label>
                                </div>
                                <small class="text-muted">Login ma'lumotlarini saqlash</small>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="twoFactorSwitch">
                                    <label class="form-check-label" for="twoFactorSwitch">
                                        üîí Ikki bosqichli autentifikatsiya
                                    </label>
                                </div>
                                <small class="text-muted">Qo'shimcha xavfsizlik</small>
                            </div>
                        </div>
                    </div>

                    <hr class="my-4">

                    <!-- Amallar -->
                    <div class="settings-section">
                        <h5>‚ö° Tezkor amallar</h5>
                        <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                            <button type="button" class="btn btn-primary" onclick="resetToDefaults()">
                                üîÑ Standart sozlamalarga qaytarish
                            </button>
                            <button type="button" class="btn btn-success" onclick="saveSettings()">
                                üíæ Sozlamalarni saqlash
                            </button>
                            <button type="button" class="btn btn-info" onclick="exportSettings()">
                                üì§ Sozlamalarni eksport qilish
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.settings-section {
    margin-bottom: 2rem;
}

.settings-section h5 {
    color: #495057;
    margin-bottom: 1rem;
    font-weight: 600;
    border-bottom: 2px solid #e9ecef;
    padding-bottom: 0.5rem;
}

.card-header {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-bottom: 1px solid #dee2e6;
}

.form-check {
    margin-bottom: 0.75rem;
}

.form-check-label {
    font-weight: 500;
}

.theme-options .form-check {
    padding: 0.75rem;
    border: 1px solid #e9ecef;
    border-radius: 0.375rem;
    margin-bottom: 0.5rem;
    transition: all 0.2s ease;
}

.theme-options .form-check:hover {
    background-color: #f8f9fa;
}

.theme-options .form-check-input:checked + .form-check-label {
    color: #0d6efd;
    font-weight: 600;
}

.btn {
    border-radius: 0.375rem;
    font-weight: 500;
}

/* Font size classes */
.font-small { font-size: 14px !important; }
.font-medium { font-size: 16px !important; }
.font-large { font-size: 18px !important; }
.font-xlarge { font-size: 20px !important; }
</style>

<script>
// Til o'zgartirish
function changeLanguage(language) {
    console.log('Changing language to:', language);
    
    // Darhol tarjima qo'llash
    if (typeof translatePage === 'function') {
        translatePage(language);
    }
    
    // LocalStorage ga saqlash
    localStorage.setItem('language', language);
    
    // Server ga yuborish
    fetch('/api/set-language', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ language: language })
    }).then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification('success', data.message || 'Til muvaffaqiyatli o\'zgartirildi');
        }
    }).catch(error => {
        console.log('Til sozlamasini saqlashda xato:', error);
        showNotification('error', 'Til mahalliy o\'zgartirildi');
    });
}

// Mavzuni o'zgartirish
function changeTheme(isDark) {
    console.log('Changing theme to:', isDark ? 'dark' : 'light');
    
    // Darhol qo'llash
    if (isDark) {
        document.body.classList.add('dark-theme');
    } else {
        document.body.classList.remove('dark-theme');
    }
    
    // LocalStorage ga saqlash
    localStorage.setItem('darkMode', isDark);
    
    // Server ga yuborish
    fetch('/api/set-theme', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ dark_theme: isDark })
    }).then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification('success', 'Mavzu muvaffaqiyatli o\'zgartirildi');
        }
    }).catch(error => {
        console.log('Mavzu sozlamasini saqlashda xato:', error);
        showNotification('info', 'Mavzu mahalliy o\'zgartirildi');
    });
}

// Font o'lchamini o'zgartirish
function changeFontSize(fontSize) {
    console.log('Changing font size to:', fontSize);
    
    // Klasslarni tozalash
    document.body.classList.remove('font-small', 'font-medium', 'font-large', 'font-xlarge');
    
    // Yangi klassni qo'shish
    document.body.classList.add('font-' + fontSize);
    
    // LocalStorage ga saqlash
    localStorage.setItem('fontSize', fontSize);
    
    // Server ga yuborish
    fetch('/api/set-font-size', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ font_size: fontSize })
    }).then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification('success', 'Shrift o\'lchami muvaffaqiyatli o\'zgartirildi');
        }
    }).catch(error => {
        console.log('Font size sozlamasini saqlashda xato:', error);
        showNotification('info', 'Shrift o\'lchami mahalliy o\'zgartirildi');
    });
}

// Standart sozlamalarga qaytarish
function resetToDefaults() {
    if (confirm('Barcha sozlamalarni standart holatga qaytarishni xohlaysizmi?')) {
        // Standart qiymatlar
        document.getElementById('languageSelect').value = 'uz';
        document.getElementById('lightTheme').checked = true;
        document.getElementById('fontSizeSelect').value = 'medium';
        
        // Qo'llash
        changeLanguage('uz');
        changeTheme(false);
        changeFontSize('medium');
        
        // Switch'larni qayta tiklash
        document.getElementById('soundSwitch').checked = true;
        document.getElementById('notificationSwitch').checked = true;
        document.getElementById('autoRefreshSwitch').checked = true;
        document.getElementById('animationsSwitch').checked = true;
        document.getElementById('rememberMeSwitch').checked = true;
        
        showNotification('success', 'Sozlamalar standart holatga qaytarildi');
    }
}

// Sozlamalarni saqlash
function saveSettings() {
    const settings = {
        language: document.getElementById('languageSelect').value,
        theme: document.querySelector('input[name="theme"]:checked').value,
        fontSize: document.getElementById('fontSizeSelect').value,
        sound: document.getElementById('soundSwitch').checked,
        notifications: document.getElementById('notificationSwitch').checked,
        autoRefresh: document.getElementById('autoRefreshSwitch').checked,
        animations: document.getElementById('animationsSwitch').checked,
        rememberMe: document.getElementById('rememberMeSwitch').checked
    };
    
    // LocalStorage ga saqlash
    localStorage.setItem('userSettings', JSON.stringify(settings));
    
    showNotification('success', 'Barcha sozlamalar saqlandi');
}

// Sozlamalarni eksport qilish
function exportSettings() {
    const settings = {
        language: document.getElementById('languageSelect').value,
        theme: document.querySelector('input[name="theme"]:checked').value,
        fontSize: document.getElementById('fontSizeSelect').value,
        sound: document.getElementById('soundSwitch').checked,
        notifications: document.getElementById('notificationSwitch').checked,
        autoRefresh: document.getElementById('autoRefreshSwitch').checked,
        animations: document.getElementById('animationsSwitch').checked,
        rememberMe: document.getElementById('rememberMeSwitch').checked,
        exportDate: new Date().toISOString()
    };
    
    const dataStr = JSON.stringify(settings, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    
    const link = document.createElement('a');
    link.href = URL.createObjectURL(dataBlob);
    link.download = 'restaurant_settings.json';
    link.click();
    
    showNotification('success', 'Sozlamalar faylga eksport qilindi');
}

// Bildirishnoma ko'rsatish
function showNotification(type, message) {
    const notification = document.createElement('div');
    notification.className = `alert alert-${type} notification`;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1050;
        min-width: 300px;
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.3s ease;
    `;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateX(0)';
    }, 100);
    
    setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
            notification.remove();
        }, 300);
    }, 3000);
}

// Sahifa yuklanganda joriy sozlamalarni qo'llash
document.addEventListener('DOMContentLoaded', function() {
    // LocalStorage dan sozlamalarni yuklab olish
    const savedSettings = localStorage.getItem('userSettings');
    if (savedSettings) {
        const settings = JSON.parse(savedSettings);
        
        // Switch'larni to'g'ri holatga keltirish
        if (settings.sound !== undefined) {
            document.getElementById('soundSwitch').checked = settings.sound;
        }
        if (settings.notifications !== undefined) {
            document.getElementById('notificationSwitch').checked = settings.notifications;
        }
        if (settings.autoRefresh !== undefined) {
            document.getElementById('autoRefreshSwitch').checked = settings.autoRefresh;
        }
        if (settings.animations !== undefined) {
            document.getElementById('animationsSwitch').checked = settings.animations;
        }
        if (settings.rememberMe !== undefined) {
            document.getElementById('rememberMeSwitch').checked = settings.rememberMe;
        }
    }
    
    console.log('General settings sahifasi yuklandi');
});
</script>
{% endblock %}
