{% extends "base.html" %} {% block title %}Umumiy sozlamalar{% endblock %} {%
block head %}
<style>
  .settings-container {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 20px 0;
  }

  .settings-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    max-width: 1000px;
    margin: 0 auto;
    backdrop-filter: blur(10px);
  }

  .settings-header {
    text-align: center;
    margin-bottom: 40px;
    padding-bottom: 20px;
    border-bottom: 2px solid #e2e8f0;
  }

  .settings-header h3 {
    color: #2d3748;
    font-weight: 700;
    margin-bottom: 10px;
  }

  .settings-header p {
    color: #718096;
    font-size: 1.1rem;
  }

  .settings-section {
    margin-bottom: 40px;
    padding: 30px;
    background: rgba(248, 250, 252, 0.8);
    border-radius: 15px;
    border: 1px solid #e2e8f0;
    transition: all 0.3s ease;
  }

  .settings-section:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  }

  .settings-section h5 {
    color: #2d3748;
    font-weight: 600;
    margin-bottom: 25px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .form-control,
  .form-select {
    border-radius: 10px;
    padding: 12px 15px;
    border: 2px solid #e2e8f0;
    transition: all 0.3s ease;
  }

  .form-control:focus,
  .form-select:focus {
    border-color: #4299e1;
    box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
    transform: translateY(-1px);
  }

  .btn-save {
    background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
    border: none;
    color: white;
    padding: 12px 30px;
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .btn-save:hover {
    background: linear-gradient(135deg, #45a049 0%, #3d8b40 100%);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(69, 160, 73, 0.4);
  }

  .btn-reset {
    background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
    border: none;
    color: white;
    padding: 12px 30px;
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .btn-reset:hover {
    background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(229, 62, 62, 0.4);
  }

  .theme-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 10px;
  }

  .theme-option {
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .theme-option:hover {
    border-color: #4299e1;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(66, 153, 225, 0.2);
  }

  .theme-option.active {
    border-color: #4299e1;
    background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
  }

  .theme-option input[type="radio"] {
    margin-right: 10px;
  }

  .language-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 10px;
  }

  .language-option {
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .language-option:hover {
    border-color: #4299e1;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(66, 153, 225, 0.2);
  }

  .language-option.active {
    border-color: #4299e1;
    background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
  }

  .language-option input[type="radio"] {
    margin-right: 10px;
  }

  .font-size-options {
    display: flex;
    gap: 10px;
    margin-top: 10px;
  }

  .font-size-option {
    flex: 1;
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .font-size-option:hover {
    border-color: #4299e1;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(66, 153, 225, 0.2);
  }

  .font-size-option.active {
    border-color: #4299e1;
    background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
  }

  .font-size-option input[type="radio"] {
    margin-right: 10px;
  }

  .notification-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 10px;
  }

  .notification-option {
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .notification-option:hover {
    border-color: #4299e1;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(66, 153, 225, 0.2);
  }

  .notification-option.active {
    border-color: #4299e1;
    background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
  }

  .notification-option input[type="checkbox"] {
    margin-right: 10px;
  }

  .preview-area {
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    padding: 20px;
    margin-top: 20px;
    min-height: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
  }

  .preview-text {
    font-size: 1.2rem;
    color: #2d3748;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .stat-card {
    background: white;
    padding: 20px;
    border-radius: 15px;
    text-align: center;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
  }

  .stat-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  }

  .stat-number {
    font-size: 2rem;
    font-weight: 700;
    color: #667eea;
    margin-bottom: 5px;
  }

  .stat-label {
    color: #718096;
    font-size: 0.9rem;
  }

  @media (max-width: 768px) {
    .settings-card {
      padding: 20px;
      margin: 10px;
    }

    .settings-section {
      padding: 20px;
    }

    .theme-options,
    .language-options,
    .notification-options {
      grid-template-columns: 1fr;
    }

    .font-size-options {
      flex-direction: column;
    }
  }
</style>
{% endblock %} {% block content %}
<div class="settings-container">
  <div class="settings-card">
    <div class="settings-header">
      <h3>{{ _('settings.title') }}</h3>
      <p>{{ _('settings.description') }}</p>
    </div>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %} {% for category, message in messages %}
    <div
      class="alert alert-{{ 'danger' if category=='error' else 'success' if category=='success' else category }} alert-dismissible fade show"
      role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %} {% endif %} {% endwith %}

    <!-- Til sozlamalari -->
    <div class="settings-section">
      <h5>{{ _('settings.language_label') }}</h5>
      <div class="language-options">
        <div
          class="language-option {{ 'active' if session.get('interface_language', 'uz') == 'uz' }}"
          onclick="selectLanguage('uz')">
          <input type="radio" name="language" value="uz" {{ 'checked' if
          session.get('interface_language', 'uz') == 'uz' }}>
          <div>üá∫üáø O'zbekcha</div>
        </div>
        <div
          class="language-option {{ 'active' if session.get('interface_language', 'uz') == 'ru' }}"
          onclick="selectLanguage('ru')">
          <input type="radio" name="language" value="ru" {{ 'checked' if
          session.get('interface_language', 'uz') == 'ru' }}>
          <div>üá∑üá∫ –†—É—Å—Å–∫–∏–π</div>
        </div>
        <div
          class="language-option {{ 'active' if session.get('interface_language', 'uz') == 'en' }}"
          onclick="selectLanguage('en')">
          <input type="radio" name="language" value="en" {{ 'checked' if
          session.get('interface_language', 'uz') == 'en' }}>
          <div>üá¨üáß English</div>
        </div>
      </div>
      <div class="form-text">Interface tili o'zgarishi darhol qo'llaniladi</div>
    </div>

    <!-- Mavzu sozlamalari -->
    <div class="settings-section">
      <h5>{{ _('settings.theme_label') }}</h5>
      <div class="theme-options">
        <div
          class="theme-option {{ 'active' if not session.get('dark_theme', False) }}"
          onclick="selectTheme(false)">
          <input type="radio" name="theme" value="light" {{ 'checked' if not
          session.get('dark_theme', False) }}>
          <div>‚òÄÔ∏è Yorug' mavzu</div>
        </div>
        <div
          class="theme-option {{ 'active' if session.get('dark_theme', False) }}"
          onclick="selectTheme(true)">
          <input type="radio" name="theme" value="dark" {{ 'checked' if
          session.get('dark_theme', False) }}>
          <div>üåô Qorong'u mavzu</div>
        </div>
      </div>

      <div class="mt-4">
        <label class="form-label">{{ _('settings.font_size_label') }}</label>
        <div class="font-size-options">
          <div
            class="font-size-option {{ 'active' if session.get('font_size', 'medium') == 'small' }}"
            onclick="selectFontSize('small')">
            <input type="radio" name="font_size" value="small" {{ 'checked' if
            session.get('font_size', 'medium') == 'small' }}>
            <div>Kichik</div>
          </div>
          <div
            class="font-size-option {{ 'active' if session.get('font_size', 'medium') == 'medium' }}"
            onclick="selectFontSize('medium')">
            <input type="radio" name="font_size" value="medium" {{ 'checked' if
            session.get('font_size', 'medium') == 'medium' }}>
            <div>O'rta</div>
          </div>
          <div
            class="font-size-option {{ 'active' if session.get('font_size', 'medium') == 'large' }}"
            onclick="selectFontSize('large')">
            <input type="radio" name="font_size" value="large" {{ 'checked' if
            session.get('font_size', 'medium') == 'large' }}>
            <div>Katta</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bildirishnoma sozlamalari -->
    <div class="settings-section">
      <h5>üîî Bildirishnoma sozlamalari</h5>
      <div class="notification-options">
        <div
          class="notification-option {{ 'active' if session.get('notifications_enabled', True) }}"
          onclick="toggleNotification('notifications_enabled')">
          <input type="checkbox" name="notifications_enabled" {{ 'checked' if
          session.get('notifications_enabled', True) }}>
          <div>üì± Push bildirishnomalar</div>
        </div>
        <div
          class="notification-option {{ 'active' if session.get('email_notifications', True) }}"
          onclick="toggleNotification('email_notifications')">
          <input type="checkbox" name="email_notifications" {{ 'checked' if
          session.get('email_notifications', True) }}>
          <div>üìß Email bildirishnomalar</div>
        </div>
        <div
          class="notification-option {{ 'active' if session.get('sms_notifications', False) }}"
          onclick="toggleNotification('sms_notifications')">
          <input type="checkbox" name="sms_notifications" {{ 'checked' if
          session.get('sms_notifications', False) }}>
          <div>üì± SMS bildirishnomalar</div>
        </div>
        <div
          class="notification-option {{ 'active' if session.get('order_updates', True) }}"
          onclick="toggleNotification('order_updates')">
          <input type="checkbox" name="order_updates" {{ 'checked' if
          session.get('order_updates', True) }}>
          <div>üì¶ Buyurtma yangilanishlari</div>
        </div>
      </div>
    </div>

    <!-- Ko'rinish namunasi -->
    <div class="settings-section">
      <h5>üëÅÔ∏è Ko'rinish namunasi</h5>
      <div class="preview-area">
        <div class="preview-text" id="previewText">
          {{ _('preview.default') }}
        </div>
      </div>
    </div>

    <!-- Saqlash tugmalari -->
    <div class="settings-section">
      <div class="d-flex gap-3">
        <button class="btn btn-save" onclick="saveSettings()">
          {{ _('settings.save') }}
        </button>
        <button class="btn btn-reset" onclick="resetSettings()">
          {{ _('settings.reset') }}
        </button>
      </div>
    </div>

    <!-- Navigatsiya tugmalari -->
    <div class="text-center">
      <a
        href="{{ url_for('profile_settings') }}"
        class="btn btn-outline-secondary me-2">
        {{ _('nav.profile_settings') }}
      </a>
      <a href="{{ url_for('profile') }}" class="btn btn-outline-primary me-2">
        {{ _('nav.profile') }}
      </a>
      <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
        {{ _('nav.home') }}
      </a>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  // Til tanlash
  function selectLanguage(language) {
    document.querySelectorAll(".language-option").forEach((option) => {
      option.classList.remove("active");
    });
    event.currentTarget.classList.add("active");

    // Darhol o'zgartirish
    changeLanguage(language);
  }

  // Mavzu tanlash
  function selectTheme(isDark) {
    document.querySelectorAll(".theme-option").forEach((option) => {
      option.classList.remove("active");
    });
    event.currentTarget.classList.add("active");

    // Darhol o'zgartirish
    changeTheme(isDark);
  }

  // Matn o'lchami tanlash
  function selectFontSize(size) {
    document.querySelectorAll(".font-size-option").forEach((option) => {
      option.classList.remove("active");
    });
    event.currentTarget.classList.add("active");

    // Darhol o'zgartirish
    changeFontSize(size);
  }

  // Bildirishnoma sozlamalari
  function toggleNotification(type) {
    const option = event.currentTarget;
    const checkbox = option.querySelector('input[type="checkbox"]');
    checkbox.checked = !checkbox.checked;

    if (checkbox.checked) {
      option.classList.add("active");
    } else {
      option.classList.remove("active");
    }
  }

  // Til o'zgartirish
  function changeLanguage(language) {
    fetch("/api/change-language", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ language: language }),
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          // Sahifani yangilash
          setTimeout(() => {
            window.location.reload();
          }, 500);
        }
      })
      .catch((error) => {
        console.error("Error changing language:", error);
      });
  }

  // Mavzu o'zgartirish
  function changeTheme(isDark) {
    fetch("/api/change-theme", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ dark_theme: isDark }),
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          // Sahifani yangilash
          setTimeout(() => {
            window.location.reload();
          }, 500);
        }
      })
      .catch((error) => {
        console.error("Error changing theme:", error);
      });
  }

  // Matn o'lchami o'zgartirish
  function changeFontSize(size) {
    fetch("/api/change-font-size", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ font_size: size }),
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          // Sahifani yangilash
          setTimeout(() => {
            window.location.reload();
          }, 500);
        }
      })
      .catch((error) => {
        console.error("Error changing font size:", error);
      });
  }

  // Sozlamalarni saqlash
  function saveSettings() {
    const settings = {
      language: document.querySelector('input[name="language"]:checked').value,
      theme: document.querySelector('input[name="theme"]:checked').value,
      font_size: document.querySelector('input[name="font_size"]:checked')
        .value,
      notifications_enabled: document.querySelector(
        'input[name="notifications_enabled"]'
      ).checked,
      email_notifications: document.querySelector(
        'input[name="email_notifications"]'
      ).checked,
      sms_notifications: document.querySelector(
        'input[name="sms_notifications"]'
      ).checked,
      order_updates: document.querySelector('input[name="order_updates"]')
        .checked,
    };

    fetch("/api/save-settings", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(settings),
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          alert("Sozlamalar saqlandi!");
          window.location.reload();
        } else {
          alert("Xatolik: " + data.message);
        }
      })
      .catch((error) => {
        console.error("Error saving settings:", error);
        alert("Sozlamalarni saqlashda xatolik");
      });
  }

  // Standart sozlamalar
  function resetSettings() {
    if (
      confirm(
        "Barcha sozlamalarni standart holatga qaytarishni tasdiqlaysizmi?"
      )
    ) {
      fetch("/api/reset-settings", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.success) {
            alert("Sozlamalar standart holatga qaytarildi!");
            window.location.reload();
          } else {
            alert("Xatolik: " + data.message);
          }
        })
        .catch((error) => {
          console.error("Error resetting settings:", error);
          alert("Sozlamalarni qaytarishda xatolik");
        });
    }
  }

  // Ko'rinish namunasi yangilash
  function updatePreview() {
    const previewText = document.getElementById("previewText");
    const fontSize = document.querySelector(
      'input[name="font_size"]:checked'
    ).value;
    const isDark =
      document.querySelector('input[name="theme"]:checked').value === "dark";

    previewText.style.fontSize =
      fontSize === "small"
        ? "0.9rem"
        : fontSize === "large"
        ? "1.4rem"
        : "1.2rem";
    previewText.style.color = isDark ? "#e2e8f0" : "#2d3748";
    previewText.style.backgroundColor = isDark ? "#2d3748" : "#ffffff";
  }

  // Sahifa yuklanganda
  document.addEventListener("DOMContentLoaded", function () {
    updatePreview();

    // Sozlamalar o'zgarishini kuzatish
    document
      .querySelectorAll('input[type="radio"], input[type="checkbox"]')
      .forEach((input) => {
        input.addEventListener("change", updatePreview);
      });
  });
</script>
{% endblock %}
