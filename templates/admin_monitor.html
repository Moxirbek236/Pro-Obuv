<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor - Restoran Tizimi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
      body {
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        color: white;
        font-family: 'Arial', sans-serif;
      }

      .monitor-container {
        padding: 20px;
        min-height: 100vh;
      }

      .monitor-header {
        text-align: center;
        margin-bottom: 30px;
        background: rgba(255,255,255,0.1);
        padding: 20px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
      }

      .monitor-header h1 {
        color: #fff;
        font-size: 2.5rem;
        font-weight: 700;
        margin: 0;
      }

      .monitor-section {
        margin-bottom: 30px;
        background: rgba(255,255,255,0.95);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      }

      .monitor-section h4 {
        color: #2d3748;
        font-weight: 700;
        margin-bottom: 20px;
        text-align: center;
        padding: 10px;
        border-radius: 10px;
      }

      .waiting-section h4 {
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      }

      .ready-section h4 {
        background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      }

      .served-section h4 {
        background: linear-gradient(135deg, #c3cfe2 0%, #c3cfe2 100%);
      }

      .monitor-table {
        font-size: 1.1rem;
        color: #2d3748;
      }

      .monitor-table th {
        background: #4a5568 !important;
        color: white !important;
        font-weight: 600;
        border: none;
      }

      .monitor-table td {
        border: 1px solid #e2e8f0;
        vertical-align: middle;
        padding: 15px 10px;
      }

      .table-warning {
        background-color: #fff3cd !important;
      }

      .table-success {
        background-color: #d1f2eb !important;
      }

      .table-info {
        background-color: #cff4fc !important;
      }

      .current-time {
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 10px 20px;
        border-radius: 10px;
        font-size: 1.2rem;
        font-weight: 600;
      }

      .ticket-number {
        font-size: 1.3rem;
        font-weight: 700;
        color: #2b6cb0;
      }

      .order-items {
        font-size: 0.9rem;
        color: #4a5568;
        background: #f7fafc;
        padding: 5px 8px;
        border-radius: 5px;
        margin-top: 5px;
      }
    </style>
</head>
<body>
    <div class="current-time" id="currentTime"></div>
    <div class="current-date-time-weather" style="position: fixed; top: 60px; right: 20px; background: rgba(0,0,0,0.7); color: white; padding: 10px 20px; border-radius: 10px; font-size: 1rem; font-weight: 500; text-align: right;">
        <div id="currentDate"></div>
        <div id="currentClock"></div>
        <div id="temperature"></div>
        <div id="weatherDesc"></div>
    </div>

    <div class="monitor-container">
        <div class="monitor-header">
            <h1>üì∫ Buyurtmalar Monitori</h1>
            <p style="margin: 10px 0 0 0; font-size: 1.1rem;">Restoran boshqaruv tizimi</p>
        </div>

        <div class="row">
            <!-- Kutayotgan buyurtmalar -->
            <div class="col-12 col-lg-4">
                <div class="monitor-section waiting-section">
                    <h4>‚è≥ Kutayotgan ({{ waiting|length }})</h4>
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover monitor-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Ticket</th>
                                    <th>Mijoz</th>
                                    <th>Tayyorlanish vaqti</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for o in waiting %}
                                <tr class="table-warning">
                                    <td>{{ loop.index }}</td>
                                    <td class="ticket-number">#{{ o['ticket_no'] }}</td>
                                    <td><strong>{{ o['customer_name'] }}</strong></td>
                                    <td>{{ o['eta_time'][:16].replace('T',' ') }}</td>
                                </tr>
                                {% if o['order_items'] %}
                                <tr class="table-warning">
                                    <td colspan="4">
                                        <div class="order-items">
                                            <strong>Buyurtma:</strong> {{ o['order_items'] }}
                                        </div>
                                    </td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Tayyor buyurtmalar -->
            <div class="col-12 col-lg-4">
                <div class="monitor-section ready-section">
                    <h4>‚úÖ Tayyor ({{ ready|length }})</h4>
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover monitor-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Ticket</th>
                                    <th>Mijoz</th>
                                    <th>Tayyor vaqti</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for o in ready %}
                                <tr class="table-success">
                                    <td>{{ loop.index }}</td>
                                    <td class="ticket-number">#{{ o['ticket_no'] }}</td>
                                    <td><strong>{{ o['customer_name'] }}</strong></td>
                                    <td>{{ o['eta_time'][:16].replace('T',' ') }}</td>
                                </tr>
                                {% if o['order_items'] %}
                                <tr class="table-success">
                                    <td colspan="4">
                                        <div class="order-items">
                                            <strong>Buyurtma:</strong> {{ o['order_items'] }}
                                        </div>
                                    </td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Berilgan buyurtmalar -->
            <div class="col-12 col-lg-4">
                <div class="monitor-section served-section">
                    <h4>üçΩÔ∏è Berildi (So'nggi 5 daqiqa)</h4>
                    {% if served_recent %}
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover monitor-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Ticket</th>
                                    <th>Mijoz</th>
                                    <th>Berilgan vaqt</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for o in served_recent %}
                                <tr class="table-info">
                                    <td>{{ loop.index }}</td>
                                    <td class="ticket-number">#{{ o['ticket_no'] }}</td>
                                    <td><strong>{{ o['customer_name'] }}</strong></td>
                                    <td>{{ o['created_at'][:16].replace('T',' ') }}</td>
                                </tr>
                                {% if o['order_items'] %}
                                <tr class="table-info">
                                    <td colspan="4" class="order-items">
                                        <strong>Mahsulotlar:</strong> {{ o['order_items'] }}
                                    </td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-center">So'nggi 5 daqiqada berilgan buyurtmalar yo'q.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <script>
        // Auto refresh every 30s
        setInterval(function() {
            location.reload();
        }, 30000);

        // Current time display
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('uz-UZ', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });

            const dateString = now.toLocaleDateString('uz-UZ', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });

            const clockString = now.toLocaleTimeString('uz-UZ', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });

            document.getElementById('currentTime').textContent = timeString;
            document.getElementById('currentDate').textContent = dateString;
            document.getElementById('currentClock').textContent = 'üïí ' + clockString;
        }

        // Weather function (OpenWeatherMap API)
        async function updateWeather() {
            try {
                // Toshkent shahri uchun ob-havo ma'lumoti
                const response = await fetch('https://api.openweathermap.org/data/2.5/weather?q=Tashkent,UZ&appid=YOUR_API_KEY&units=metric&lang=uz');

                if (!response.ok) {
                    // Agar API ishlamasa, standart ma'lumot ko'rsatamiz
                    document.getElementById('temperature').textContent = 'üå°Ô∏è 22¬∞C';
                    document.getElementById('weatherDesc').textContent = '‚òÄÔ∏è Ochiq';
                    return;
                }

                const data = await response.json();
                const temp = Math.round(data.main.temp);
                const description = data.weather[0].description;

                // Weather icon mapping
                const iconMap = {
                    'clear sky': '‚òÄÔ∏è',
                    'few clouds': 'üå§Ô∏è',
                    'scattered clouds': '‚õÖ',
                    'broken clouds': '‚òÅÔ∏è',
                    'shower rain': 'üå¶Ô∏è',
                    'rain': 'üåßÔ∏è',
                    'thunderstorm': '‚õàÔ∏è',
                    'snow': '‚ùÑÔ∏è',
                    'mist': 'üå´Ô∏è'
                };

                const icon = iconMap[description] || '‚òÅÔ∏è';

                document.getElementById('temperature').textContent = `üå°Ô∏è ${temp}¬∞C`;
                document.getElementById('weatherDesc').textContent = `${icon} ${description}`;

            } catch (error) {
                console.log('Ob-havo ma\'lumotini olishda xato:', error);
                // Xato bo'lsa standart ma'lumot
                document.getElementById('temperature').textContent = 'üå°Ô∏è 22¬∞C';
                document.getElementById('weatherDesc').textContent = '‚òÄÔ∏è Ochiq';
            }
        }

        // Simulate weather if no API key (for demo)
        function simulateWeather() {
            const temperatures = [18, 20, 22, 25, 28, 24, 21];
            const weathers = [
                {temp: 22, desc: '‚òÄÔ∏è Ochiq', icon: 'üå°Ô∏è'},
                {temp: 19, desc: '‚õÖ Qisman bulutli', icon: 'üå°Ô∏è'},
                {temp: 16, desc: '‚òÅÔ∏è Bulutli', icon: 'üå°Ô∏è'},
                {temp: 24, desc: 'üå§Ô∏è Issiq', icon: 'üå°Ô∏è'}
            ];

            const randomWeather = weathers[Math.floor(Math.random() * weathers.length)];

            document.getElementById('temperature').textContent = `${randomWeather.icon} ${randomWeather.temp}¬∞C`;
            document.getElementById('weatherDesc').textContent = randomWeather.desc;
        }

        // Initialize
        updateTime();
        simulateWeather();

        // Update every second for time, every 5 minutes for weather
        setInterval(updateTime, 1000);
        setInterval(simulateWeather, 300000); // 5 minutes
    </script>
</body>
</html>