
<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor - Restoran Tizimi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
      body {
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        color: white;
        font-family: 'Arial', sans-serif;
      }
      
      .monitor-container {
        padding: 20px;
        min-height: 100vh;
      }
      
      .monitor-header {
        text-align: center;
        margin-bottom: 30px;
        background: rgba(255,255,255,0.1);
        padding: 20px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
      }
      
      .monitor-header h1 {
        color: #fff;
        font-size: 2.5rem;
        font-weight: 700;
        margin: 0;
      }
      
      .monitor-section {
        margin-bottom: 30px;
        background: rgba(255,255,255,0.95);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      }
      
      .monitor-section h4 {
        color: #2d3748;
        font-weight: 700;
        margin-bottom: 20px;
        text-align: center;
        padding: 10px;
        border-radius: 10px;
      }
      
      .waiting-section h4 {
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      }
      
      .ready-section h4 {
        background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      }
      
      .served-section h4 {
        background: linear-gradient(135deg, #c3cfe2 0%, #c3cfe2 100%);
      }
      
      .monitor-table {
        font-size: 1.1rem;
        color: #2d3748;
      }
      
      .monitor-table th {
        background: #4a5568 !important;
        color: white !important;
        font-weight: 600;
        border: none;
      }
      
      .monitor-table td {
        border: 1px solid #e2e8f0;
        vertical-align: middle;
        padding: 15px 10px;
      }
      
      .table-warning {
        background-color: #fff3cd !important;
      }
      
      .table-success {
        background-color: #d1f2eb !important;
      }
      
      .table-info {
        background-color: #cff4fc !important;
      }
      
      .current-time {
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(0,0,0,0.7);
        color: white;
        padding: 10px 20px;
        border-radius: 10px;
        font-size: 1.2rem;
        font-weight: 600;
      }
      
      .ticket-number {
        font-size: 1.3rem;
        font-weight: 700;
        color: #2b6cb0;
      }
      
      .order-items {
        font-size: 0.9rem;
        color: #4a5568;
        background: #f7fafc;
        padding: 5px 8px;
        border-radius: 5px;
        margin-top: 5px;
      }
    </style>
</head>
<body>
    <div class="current-time" id="currentTime"></div>
    
    <div class="monitor-container">
        <div class="monitor-header">
            <h1>üì∫ Buyurtmalar Monitori</h1>
            <p style="margin: 10px 0 0 0; font-size: 1.1rem;">Restoran boshqaruv tizimi</p>
        </div>

        <div class="row">
            <!-- Kutayotgan buyurtmalar -->
            <div class="col-12 col-lg-4">
                <div class="monitor-section waiting-section">
                    <h4>‚è≥ Kutayotgan ({{ waiting|length }})</h4>
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover monitor-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Ticket</th>
                                    <th>Mijoz</th>
                                    <th>Tayyorlanish vaqti</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for o in waiting %}
                                <tr class="table-warning">
                                    <td>{{ loop.index }}</td>
                                    <td class="ticket-number">#{{ o['ticket_no'] }}</td>
                                    <td><strong>{{ o['customer_name'] }}</strong></td>
                                    <td>{{ o['eta_time'][:16].replace('T',' ') }}</td>
                                </tr>
                                {% if o['order_items'] %}
                                <tr class="table-warning">
                                    <td colspan="4">
                                        <div class="order-items">
                                            <strong>Buyurtma:</strong> {{ o['order_items'] }}
                                        </div>
                                    </td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Tayyor buyurtmalar -->
            <div class="col-12 col-lg-4">
                <div class="monitor-section ready-section">
                    <h4>‚úÖ Tayyor ({{ ready|length }})</h4>
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover monitor-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Ticket</th>
                                    <th>Mijoz</th>
                                    <th>Tayyor vaqti</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for o in ready %}
                                <tr class="table-success">
                                    <td>{{ loop.index }}</td>
                                    <td class="ticket-number">#{{ o['ticket_no'] }}</td>
                                    <td><strong>{{ o['customer_name'] }}</strong></td>
                                    <td>{{ o['eta_time'][:16].replace('T',' ') }}</td>
                                </tr>
                                {% if o['order_items'] %}
                                <tr class="table-success">
                                    <td colspan="4">
                                        <div class="order-items">
                                            <strong>Buyurtma:</strong> {{ o['order_items'] }}
                                        </div>
                                    </td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Berilgan buyurtmalar -->
            <div class="col-12 col-lg-4">
                <div class="monitor-section served-section">
                    <h4>üéØ Berildi (Oxirgi 5 daqiqa)</h4>
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover monitor-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Ticket</th>
                                    <th>Mijoz</th>
                                    <th>Berilgan vaqt</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for o in served_recent %}
                                <tr class="table-info">
                                    <td>{{ loop.index }}</td>
                                    <td class="ticket-number">#{{ o['ticket_no'] }}</td>
                                    <td><strong>{{ o['customer_name'] }}</strong></td>
                                    <td>{{ o['created_at'][:16].replace('T',' ') }}</td>
                                </tr>
                                {% if o['order_items'] %}
                                <tr class="table-info">
                                    <td colspan="4">
                                        <div class="order-items">
                                            <strong>Buyurtma:</strong> {{ o['order_items'] }}
                                        </div>
                                    </td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Joriy vaqtni ko'rsatish
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('uz-UZ', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const dateString = now.toLocaleDateString('uz-UZ');
            document.getElementById('currentTime').textContent = `${dateString} ${timeString}`;
        }
        
        // Har soniyada vaqtni yangilash
        updateTime();
        setInterval(updateTime, 1000);
        
        // Har 5 soniyada sahifani yangilash
        setInterval(function() {
            location.reload();
        }, 5000);
    </script>
</body>
</html>
