{% extends "base.html" %} {% block title %}Mahsulotlar - Do'kon{% endblock %} {% block content %}
<div class="menu-container">
  <div class="main-content">
    <!-- Left Sidebar Filters -->
    <div class="filter-sidebar">
      <h3 class="filter-title">üîç Filter va qidiruv</h3>
      
      <!-- Search -->
      <div class="filter-section">
        <label for="menuSearchInput">Qidirish</label>
        <input
          id="menuSearchInput"
          type="search"
          placeholder="Qidirish... (nom, tavsif)"
          class="filter-input" />
      </div>

      <!-- Category Filter -->
      <div class="filter-section">
        <label for="filterCategory">Kategoriya</label>
        <select id="filterCategory" class="filter-select">
          <option value="">Barcha turdagi</option>
          <option value="specobuv">ü•æ –°–ø–µ—Ü–æ–±—É–≤—å</option>
          <option value="specodezhda">ü¶∫ –°–ø–µ—Ü–æ–¥–µ–∂–¥–∞</option>
        </select>
      </div>

      <!-- Sort Filter -->
      <div class="filter-section">
        <label for="filterSort">Saralash</label>
        <select id="filterSort" class="filter-select">
          <option value="">Standart</option>
          <option value="popularity">Ommaboplik</option>
          <option value="rating">Bahoga ko'ra</option>
          <option value="name_asc">Nomi: A-Z</option>
          <option value="name_desc">Nomi: Z-A</option>
        </select>
      </div>

      <!-- Size Filter -->
      <div class="filter-section">
        <label for="filterSize">O'lcham</label>
        <input
          id="filterSize"
          type="text"
          placeholder="Masalan: 40"
          class="filter-input" />
      </div>

      <!-- Color Filter -->
      <div class="filter-section">
        <label for="filterColor">Rang</label>
        <input
          id="filterColor"
          type="text"
          placeholder="Masalan: qora"
          class="filter-input" />
      </div>

      <!-- Clear Filters -->
      <button id="clearFiltersBtn" class="clear-btn">
        üóëÔ∏è Barchasini tozalash
      </button>
      
      <!-- Links Section -->
      <div class="filter-links">
        <a href="{{ url_for('about') }}" class="filter-link">
          üìã Biz haqimizda
        </a>
        <a href="{{ url_for('contact') }}" class="filter-link">
          üìû Bog'lanish
        </a>
        <a href="{{ url_for('index') }}" class="filter-link">
          üè† Bosh sahifa
        </a>
      </div>
    </div>

    <!-- Mobile Filter Toggle -->
    <button class="mobile-filter-toggle d-md-none" onclick="toggleMobileFilter()">
      üîç Filterlar
    </button>
    
    <!-- Right Content Area -->
    <div class="content-area">
      <!-- professional-header and menu-title moved to templates/kafolatlar.html -->
      
      <!-- Kategoriya tugmalari -->
      <div class="category-buttons">
        <button
          class="category-btn active"
          onclick="showCategory('all')"
          data-translate="all_categories">
          üîÑ –í—Å–µ —Ç–æ–≤–∞—Ä—ã
        </button>
        <button
          class="category-btn"
          onclick="showCategory('specobuv')"
          data-translate="specobuv_category">
          ü•æ –°–ø–µ—Ü–æ–±—É–≤—å
        </button>
        <button
          class="category-btn"
          onclick="showCategory('specodezhda')"
          data-translate="specodezhda_category">
          ü¶∫ –°–ø–µ—Ü–æ–¥–µ–∂–¥–∞
        </button>
      </div>

      <!-- Spetsial'naya odezhda i obuv' -->
      <div class="menu-section" id="products-section">
        <h2 class="section-title">ü•æ –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–¥–µ–∂–¥–∞ –∏ –æ–±—É–≤—å</h2>
        <div class="menu-grid">
      {% for item in men %}
      <div
        class="menu-item"
        data-category="{{ item.category if item.category else 'product' }}"
        onclick="openItemModal({{ item.id }})">
        <div class="item-image">
          <img
            src="{{ item.image_url or '/static/images/default-men.jpg' }}"
            alt="{{ item.name }}"
            onerror="this.src='/static/images/default-men.jpg'" />
          <!-- Sevimli icon chap tepa burchakda -->
          {% if session.user_id %}
          <form
            method="post"
            action="{{ url_for('add_to_favorites', menu_item_id=item.id) }}"
            class="favorite-form"
            onclick="event.stopPropagation()">
            <button type="submit" class="btn-favorite-top">‚ù§Ô∏è</button>
          </form>
          {% endif %}
        </div>
        <div class="item-content">
          <h3 class="item-name">{{ item.name }}</h3>
          <p class="item-description">
            {{ item.description or 'Mahsulot haqida' }}
          </p>

          <!-- Baholar -->
          <div class="rating-section">
            <div class="stars">
              {% for i in range(1, 6) %}
              <span
                class="star {% if i <= (item.rating or 0) %}filled{% endif %}"
                >‚≠ê</span
              >
              {% endfor %}
            </div>
            <span class="rating-text"
              >{{ "%.1f"|format(item.rating or 0) }} ({{ item.orders_count or 0
              }} buyurtma)</span
            >
          </div>

          <div class="item-footer">

            <!-- Miqdor va savatcha -->
            <div class="add-to-cart-section">
              <form
                method="POST"
                action="{{ url_for('add_to_cart') }}"
                onclick="event.stopPropagation()">
                <input
                  type="hidden"
                  name="menu_item_id"
                  value="{{ item.id }}" />
                <div class="quantity-cart-controls">
                  <button
                    type="button"
                    class="quantity-btn minus"
                    onclick="decreaseQuantity(this)">
                    ‚àí
                  </button>
                  <input
                    type="number"
                    name="quantity"
                    value="1"
                    min="1"
                    max="99"
                    class="quantity-input" />
                  <button
                    type="button"
                    class="quantity-btn plus"
                    onclick="increaseQuantity(this)">
                    +
                  </button>
                  <button type="submit" class="btn-cart">üõí</button>
                </div>
              </form>
            </div>

            <!-- Baholash tugmasi -->
            {% if session.user_id %}
            <div class="rating-button-section">
              <button
                type="button"
                class="btn-rate"
                onclick="openRatingModal({{ item.id }}, event)">
                ‚≠ê Baholash
              </button>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Floating Cart Icon -->

<!-- Modal oyna mahsulot tafsilotlari uchun -->
<div id="itemModal" class="modal-overlay" onclick="closeItemModal()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header">
      <h2 id="modalTitle"></h2>
      <button class="modal-close" onclick="closeItemModal()">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="modal-image">
        <img id="modalImage" src="" alt="" />
      </div>
      <div class="modal-details">
        <p id="modalDescription"></p>
        <div class="modal-rating">
          <div class="stars" id="modalStars"></div>
          <span id="modalRatingText"></span>
        </div>
        <div class="modal-actions">
          <form
            id="modalCartForm"
            method="POST"
            action="{{ url_for('add_to_cart') }}">
            <input
              type="hidden"
              id="modalItemId"
              name="menu_item_id"
              value="" />
            <!-- Enhanced Size and color selections with beautiful styling -->
            <div class="modal-options-container">
              <div class="modal-option-group">
                <label for="modalSize" class="modal-option-label">
                  <span class="option-icon">üìè</span>
                  <span class="option-text">O'lcham tanlang</span>
                </label>
                <div class="select-wrapper">
                  <select
                    id="modalSize"
                    name="size"
                    aria-label="O'lcham"
                    data-required="false"
                    class="modal-select">
                    <option value="" selected disabled>O'lcham tanlang</option>
                  </select>
                  <div class="select-arrow">‚ñº</div>
                </div>
              </div>
              
              <div class="modal-option-group">
                <label for="modalColor" class="modal-option-label">
                  <span class="option-icon">üé®</span>
                  <span class="option-text">Rang tanlang</span>
                </label>
                <div class="select-wrapper">
                  <select
                    id="modalColor"
                    name="color"
                    aria-label="Rang"
                    data-required="false"
                    class="modal-select">
                    <option value="" selected disabled>Rang tanlang</option>
                  </select>
                  <div class="select-arrow">‚ñº</div>
                </div>
              </div>
            </div>
            <div class="quantity-selector">
              <button type="button" onclick="decreaseModalQuantity()">-</button>
              <input
                type="number"
                id="modalQuantity"
                name="quantity"
                value="1"
                min="1"
                max="99" />
              <button type="button" onclick="increaseModalQuantity()">+</button>
            </div>
            <button
              type="submit"
              class="btn-add-cart"
              id="modalAddToCartBtn"
              disabled>
              üõí Savatchaga qo'shish
            </button>
          </form>
        </div>

        <!-- Sharhlar bo'limi -->
        <div class="comments-section">
          <h3>Mijozlar sharhlari</h3>
          <div id="modalComments" class="comments-list">
            <!-- Sharhlar bu yerda dinamik yuklash -->
          </div>
        </div>
      </div>
    </div>
</div>
</div>

<style>

  /* ================================
     MENU PAGE LAYOUT
     ================================ */
  .menu-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
    animation: fadeIn 0.6s ease-out;
  }

  .main-content {
    display: flex;
    gap: 30px;
    margin-top: 20px;
    max-width: 1600px;
    margin-left: auto;
    margin-right: auto;
    position: relative;
  }

  /* ================================
     FILTER SIDEBAR
     ================================ */
  .filter-sidebar {
    position: fixed;
    left: 20px;
    top: 120px;
    width: 280px; /* Reduced from 320px */
    background: rgba(255, 255, 255, 0.98);
    border-radius: 16px;
    padding: 25px; /* Reduced from 30px */
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    height: fit-content;
    max-height: calc(100vh - 400px); /* Leave space for news ticker and footer */
    overflow-y: auto;
    z-index: 99; /* Below news ticker (100) and footer (1000), but above content */
    border: 1px solid rgba(226, 232, 240, 0.8);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
  }
  
  /* Ensure proper z-index hierarchy */
  .navbar {
    z-index: 1050 !important;
    position: relative;
  }
  
  .footer {
    z-index: 1000;
    position: relative;
  }
  
  .news-ticker-container {
    z-index: 100 !important;
    position: relative;
  }

  .filter-title {
    color: #2d3748;
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 25px;
    text-align: center;
    border-bottom: 2px solid #e2e8f0;
    padding-bottom: 15px;
  }

  .filter-section {
    margin-bottom: 20px;
  }

  .filter-section label {
    display: block;
    color: #4a5568;
    font-weight: 500;
    margin-bottom: 8px;
    font-size: 0.9rem;
  }

  .filter-input {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    border: 2px solid #e2e8f0;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    box-sizing: border-box;
  }

  .filter-input:focus {
    outline: none;
    border-color: #4299e1;
    box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
  }

  .filter-select {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    border: 2px solid #e2e8f0;
    background: white;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s ease;
    box-sizing: border-box;
  }

  .filter-select:focus {
    outline: none;
    border-color: #4299e1;
    box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
  }

  .clear-btn {
    width: 100%;
    padding: 12px;
    background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 10px;
  }

  .clear-btn:hover {
    background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(245, 101, 101, 0.4);
  }
  
  /* ================================
     MOBILE FILTER TOGGLE
     ================================ */
  .mobile-filter-toggle {
    width: 100%;
    padding: 12px 20px;
    background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    margin-bottom: 20px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(66, 153, 225, 0.3);
  }
  
  .mobile-filter-toggle:hover {
    background: linear-gradient(135deg, #3182ce 0%, #2b6cb0 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(66, 153, 225, 0.4);
  }

  .filter-links {
    margin-top: 25px;
    padding-top: 20px;
    border-top: 2px solid #e2e8f0;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .filter-link {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 16px;
    background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(66, 153, 225, 0.3);
  }

  .filter-link:hover {
    background: linear-gradient(135deg, #3182ce 0%, #2c5282 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(66, 153, 225, 0.4);
    color: white;
    text-decoration: none;
  }

  .filter-link:nth-child(2) {
    background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
    box-shadow: 0 2px 4px rgba(72, 187, 120, 0.3);
  }

  .filter-link:nth-child(2):hover {
    background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
    box-shadow: 0 4px 8px rgba(72, 187, 120, 0.4);
  }

  .filter-link:nth-child(3) {
    background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
    box-shadow: 0 2px 4px rgba(237, 137, 54, 0.3);
  }

  .filter-link:nth-child(3):hover {
    background: linear-gradient(135deg, #dd6b20 0%, #c05621 100%);
    box-shadow: 0 4px 8px rgba(237, 137, 54, 0.4);
  }

  /* ================================
     CONTENT AREA
     ================================ */
  .content-area {
    margin-left: 320px;
    flex: 1;
    min-width: 0;
    width: calc(100% - 380px); /* Reduced from 320px to prevent overflow */
    max-width: 1200px; /* Set maximum width */
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    padding-right: 20px; /* Reduced padding */
    padding-left: 10px;
    box-sizing: border-box;
    margin-right: auto; /* Center the content area */
    display: flex;
    flex-direction: column;
    align-items: center; /* Center content horizontally */
  }
  
  /* ================================
     PROFESSIONAL HEADER WITH ANIMATED CONSTRUCTION TAPE
     ================================ */
  .professional-header {
    position: relative;
    text-align: center;
    margin-bottom: 40px;
    padding: 60px 20px;
    overflow: hidden;
    width: 100%;
    max-width: 800px;
    border-radius: 20px;
    background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  }
  
  .construction-tape-container {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    overflow: hidden;
  }
  
  .construction-tape {
    position: absolute;
    background: repeating-linear-gradient(
      45deg,
      #ffcc00 0,
      #ffcc00 15px,
      #000000 15px,
      #000000 30px
    );
    transform-origin: center;
    border: 2px solid #e6b800;
    box-shadow: 
      inset 0 2px 4px rgba(255, 255, 255, 0.3),
      inset 0 -2px 4px rgba(0, 0, 0, 0.3),
      0 4px 12px rgba(0, 0, 0, 0.4);
  }
  
  .tape-1 {
    width: 25px;
    height: 140%;
    left: -12px;
    top: -20%;
    animation: tapeWaveVertical1 8s ease-in-out infinite;
    border-radius: 12px;
    transform-style: preserve-3d;
  }
  
  .tape-2 {
    width: 25px;
    height: 140%;
    right: -12px;
    top: -20%;
    animation: tapeWaveVertical2 8s ease-in-out infinite;
    border-radius: 12px;
    transform-style: preserve-3d;
    animation-delay: -2s;
  }
  
  .tape-3 {
    width: 140%;
    height: 25px;
    top: -12px;
    left: -20%;
    animation: tapeWaveHorizontal1 8s ease-in-out infinite;
    border-radius: 12px;
    transform-style: preserve-3d;
    animation-delay: -4s;
  }
  
  .tape-4 {
    width: 140%;
    height: 25px;
    bottom: -12px;
    left: -20%;
    animation: tapeWaveHorizontal2 8s ease-in-out infinite;
    border-radius: 12px;
    transform-style: preserve-3d;
    animation-delay: -6s;
  }
  
  /* Flexible ribbon-like wave animations */
  @keyframes tapeWaveVertical1 {
    0% { 
      transform: rotateY(0deg) rotateZ(2deg) scaleY(0.98) translateX(5px);
      filter: brightness(1);
    }
    25% { 
      transform: rotateY(15deg) rotateZ(-3deg) scaleY(1.02) translateX(-3px);
      filter: brightness(1.1);
    }
    50% { 
      transform: rotateY(0deg) rotateZ(1deg) scaleY(0.99) translateX(7px);
      filter: brightness(0.9);
    }
    75% { 
      transform: rotateY(-12deg) rotateZ(-2deg) scaleY(1.01) translateX(-4px);
      filter: brightness(1.05);
    }
    100% { 
      transform: rotateY(0deg) rotateZ(2deg) scaleY(0.98) translateX(5px);
      filter: brightness(1);
    }
  }
  
  @keyframes tapeWaveVertical2 {
    0% { 
      transform: rotateY(0deg) rotateZ(-2deg) scaleY(1.01) translateX(-5px);
      filter: brightness(1.05);
    }
    25% { 
      transform: rotateY(-15deg) rotateZ(3deg) scaleY(0.98) translateX(4px);
      filter: brightness(0.95);
    }
    50% { 
      transform: rotateY(0deg) rotateZ(-1deg) scaleY(1.02) translateX(-6px);
      filter: brightness(1.1);
    }
    75% { 
      transform: rotateY(12deg) rotateZ(2deg) scaleY(0.99) translateX(3px);
      filter: brightness(0.9);
    }
    100% { 
      transform: rotateY(0deg) rotateZ(-2deg) scaleY(1.01) translateX(-5px);
      filter: brightness(1.05);
    }
  }
  
  @keyframes tapeWaveHorizontal1 {
    0% { 
      transform: rotateX(0deg) rotateZ(1deg) scaleX(0.99) translateY(4px);
      filter: brightness(1);
    }
    25% { 
      transform: rotateX(12deg) rotateZ(-2deg) scaleX(1.01) translateY(-3px);
      filter: brightness(1.08);
    }
    50% { 
      transform: rotateX(0deg) rotateZ(1.5deg) scaleX(0.98) translateY(6px);
      filter: brightness(0.92);
    }
    75% { 
      transform: rotateX(-10deg) rotateZ(-1deg) scaleX(1.02) translateY(-2px);
      filter: brightness(1.06);
    }
    100% { 
      transform: rotateX(0deg) rotateZ(1deg) scaleX(0.99) translateY(4px);
      filter: brightness(1);
    }
  }
  
  @keyframes tapeWaveHorizontal2 {
    0% { 
      transform: rotateX(0deg) rotateZ(-1deg) scaleX(1.01) translateY(-4px);
      filter: brightness(1.06);
    }
    25% { 
      transform: rotateX(-12deg) rotateZ(2deg) scaleX(0.98) translateY(5px);
      filter: brightness(0.94);
    }
    50% { 
      transform: rotateX(0deg) rotateZ(-1.5deg) scaleX(1.02) translateY(-5px);
      filter: brightness(1.1);
    }
    75% { 
      transform: rotateX(10deg) rotateZ(1deg) scaleX(0.99) translateY(3px);
      filter: brightness(0.88);
    }
    100% { 
      transform: rotateX(0deg) rotateZ(-1deg) scaleX(1.01) translateY(-4px);
      filter: brightness(1.06);
    }
  }
  
  .main-title-container {
    position: relative;
    z-index: 10;
  }
  
  .main-pro-obuv-title {
    font-size: 4.5rem;
    font-weight: 900;
    letter-spacing: 0.1em;
    margin: 0 0 20px 0;
    text-transform: uppercase;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    text-shadow: 
      0 0 20px rgba(255, 102, 0, 0.8),
      0 0 40px rgba(255, 102, 0, 0.6),
      0 0 60px rgba(255, 102, 0, 0.4),
      2px 2px 4px rgba(0, 0, 0, 0.8);
  }
  
  .title-gradient {
    background: linear-gradient(45deg, 
      #ff6600 0%, 
      #ffaa00 25%, 
      #ffffff 50%, 
      #ffaa00 75%, 
      #ff6600 100%);
    background-size: 200% 200%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: titleGradientShift 3s ease-in-out infinite;
  }
  
  .title-separator {
    font-size: 3rem;
    color: #ffcc00;
    animation: separatorPulse 2s ease-in-out infinite;
    text-shadow: 0 0 30px #ffcc00;
  }
  
  @keyframes titleGradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }
  
  @keyframes separatorPulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.8; }
  }
  
  .subtitle-masters {
    font-size: 1.2rem;
    font-weight: 600;
    color: #ffcc00;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    background: linear-gradient(90deg, 
      transparent 0%, 
      rgba(255, 204, 0, 0.2) 50%, 
      transparent 100%);
    padding: 10px 20px;
    border-radius: 25px;
    border: 2px solid rgba(255, 204, 0, 0.3);
    animation: subtitleGlow 4s ease-in-out infinite;
    text-shadow: 0 0 10px rgba(255, 204, 0, 0.8);
  }
  
  @keyframes subtitleGlow {
    0%, 100% { box-shadow: 0 0 20px rgba(255, 204, 0, 0.3); }
    50% { box-shadow: 0 0 40px rgba(255, 204, 0, 0.6); }
  }

  /* ================================
     PROFESSIONAL CONSTRUCTION MENU TITLE
     ================================ */
  .menu-title {
    position: relative;
    width: 100%;
    margin-bottom: 40px;
    padding: 40px 30px;
    background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #404040 100%);
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 
      0 20px 50px rgba(0, 0, 0, 0.4),
      inset 0 1px 0 rgba(255, 255, 255, 0.1),
      0 0 0 3px #ff6600;
    text-align: center;
    border: 3px solid #ff6600;
    animation: professionalGlow 4s ease-in-out infinite alternate;
  }
  
  /* Professional Construction Header */
  .construction-header {
    position: relative;
    z-index: 2;
    margin-bottom: 25px;
  }
  
  .safety-icons {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 20px;
    animation: iconsFloat 3s ease-in-out infinite alternate;
  }
  
  .safety-icon {
    font-size: 2.5rem;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
    transition: all 0.3s ease;
    animation-delay: calc(var(--i, 0) * 0.2s);
  }
  
  .safety-icon:nth-child(1) { --i: 0; }
  .safety-icon:nth-child(2) { --i: 1; }
  .safety-icon:nth-child(3) { --i: 2; }
  .safety-icon:nth-child(4) { --i: 3; }
  .safety-icon:nth-child(5) { --i: 4; }
  
  /* Individual icon animations */
  .safety-icon.rotating {
    animation: iconRotate 3s linear infinite;
  }
  
  .safety-icon.bouncing {
    animation: iconBounce 2s ease-in-out infinite;
  }
  
  .safety-icon.waving {
    animation: iconWave 2.5s ease-in-out infinite;
  }
  
  .safety-icon.scaling {
    animation: iconScale 2s ease-in-out infinite;
  }
  
  .safety-icon.pulsing {
    animation: iconPulse 1.8s ease-in-out infinite;
  }
  
  /* Professional Title Styling */
  .professional-title {
    font-size: 3rem;
    font-weight: 900;
    margin: 0;
    color: #ff6600 !important;
    text-shadow: 
      0 2px 4px rgba(0, 0, 0, 0.8),
      0 0 20px rgba(255, 102, 0, 0.5);
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    z-index: 2;
    animation: titleGlow 3s ease-in-out infinite alternate;
  }
  
  /* PRO-OBUV Brand Name */
  .title-brand {
    font-size: 2.8rem;
    font-weight: 900;
    color: #ff6600 !important;
    text-shadow: 
      0 2px 4px rgba(0, 0, 0, 0.8),
      0 0 25px rgba(255, 102, 0, 0.8),
      0 0 35px rgba(255, 102, 0, 0.6);
    letter-spacing: 3px;
    animation: brandGlow 2s ease-in-out infinite alternate;
    background: linear-gradient(45deg, #ff6600, #ffaa00, #ff6600);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 10px;
  }
  
  .title-main {
    font-size: 2.5rem;
    font-weight: 900;
    color: #ffffff !important;
    text-shadow: 
      0 2px 4px rgba(0, 0, 0, 0.8),
      0 0 15px rgba(255, 255, 255, 0.3);
    letter-spacing: 2px;
    animation: titlePulse 2s ease-in-out infinite alternate;
  }
  
  .title-sub {
    font-size: 1.8rem;
    font-weight: 700;
    color: #ffcc00 !important;
    text-shadow: 
      0 2px 4px rgba(0, 0, 0, 0.8),
      0 0 15px rgba(255, 204, 0, 0.5);
    letter-spacing: 1px;
    animation: subtitleShine 3s ease-in-out infinite;
  }
  
  .construction-badge.premium-badge {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    background: linear-gradient(135deg, #ff6600 0%, #ffaa00 50%, #ff6600 100%);
    padding: 10px 25px;
    border-radius: 30px;
    margin-top: 15px;
    border: 3px solid #ffffff;
    box-shadow: 
      0 4px 20px rgba(255, 102, 0, 0.5),
      inset 0 2px 4px rgba(255, 255, 255, 0.3);
    animation: premiumBadgePulse 2s ease-in-out infinite;
    position: relative;
    overflow: hidden;
  }
  
  .premium-badge::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    animation: premiumShine 3s linear infinite;
  }
  
  .badge-text {
    color: #ffffff;
    font-weight: 700;
    font-size: 0.9rem;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  }
  
  .badge-check.glowing {
    color: #ffffff;
    font-size: 1.2rem;
    font-weight: 900;
    animation: checkGlow 1.5s ease-in-out infinite;
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
  }
  
  .professional-subtitle {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    margin: 20px 0;
    padding: 15px 25px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 25px;
    border: 1px solid rgba(255, 102, 0, 0.3);
    backdrop-filter: blur(10px);
  }
  
  .subtitle-left.gradient-text,
  .subtitle-right.gradient-text {
    font-size: 1.1rem;
    font-weight: 600;
    background: linear-gradient(45deg, #ffffff, #ffaa00, #ffffff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
    animation: gradientShift 3s ease-in-out infinite;
  }
  
  .subtitle-center.diamond {
    font-size: 1.5rem;
    color: #ff6600;
    animation: diamondSpin 2s ease-in-out infinite;
    text-shadow: 0 0 15px rgba(255, 102, 0, 0.8);
  }
  
  .quality-indicators {
    display: flex;
    justify-content: center;
    gap: 25px;
    margin-top: 25px;
    flex-wrap: wrap;
  }
  
  .quality-item.enhanced {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 15px 20px;
    background: linear-gradient(135deg, rgba(255, 102, 0, 0.1), rgba(255, 170, 0, 0.1));
    border-radius: 15px;
    border: 2px solid rgba(255, 102, 0, 0.3);
    backdrop-filter: blur(15px);
    transition: all 0.3s ease;
    animation: enhancedQualityFloat 4s ease-in-out infinite;
    animation-delay: calc(var(--delay, 0) * 0.5s);
    position: relative;
    overflow: hidden;
  }
  
  .quality-item.enhanced::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    animation: qualityShine 3s linear infinite;
    animation-delay: calc(var(--delay, 0) * 0.8s);
  }
  
  .quality-item.enhanced:nth-child(1) { --delay: 0; }
  .quality-item.enhanced:nth-child(2) { --delay: 1; }
  .quality-item.enhanced:nth-child(3) { --delay: 2; }
  .quality-item.enhanced:nth-child(4) { --delay: 3; }
  
  .quality-item:hover {
    transform: translateY(-5px) scale(1.05);
    background: rgba(255, 102, 0, 0.2);
    border-color: #ff6600;
    box-shadow: 0 10px 25px rgba(255, 102, 0, 0.3);
  }
  
  .quality-icon {
    font-size: 2rem;
    animation: iconRotate 3s ease-in-out infinite;
  }
  
  .quality-text {
    font-size: 0.9rem;
    font-weight: 700;
    color: #ffffff;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
    letter-spacing: 1px;
  }
  
  .title-glow {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 300px;
    height: 300px;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
    border-radius: 50%;
    animation: glowPulse 4s ease-in-out infinite;
    pointer-events: none;
    z-index: 0;
  }
  
  /* Professional Keyframe Animations */
  @keyframes professionalGlow {
    0% { 
      box-shadow: 
        0 20px 50px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        0 0 0 3px #ff6600;
    }
    100% { 
      box-shadow: 
        0 25px 60px rgba(0, 0, 0, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.2),
        0 0 0 3px #ff8800,
        0 0 30px rgba(255, 102, 0, 0.3);
    }
  }
  
  @keyframes iconsFloat {
    0%, 100% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(-8px);
    }
  }
  
  @keyframes iconBounce {
    0%, 100% {
      transform: translateY(0px) scale(1);
    }
    50% {
      transform: translateY(-10px) scale(1.1);
    }
  }
  
  @keyframes titleGlow {
    0% {
      text-shadow: 
        0 2px 4px rgba(0, 0, 0, 0.8),
        0 0 20px rgba(255, 102, 0, 0.5);
    }
    100% {
      text-shadow: 
        0 2px 4px rgba(0, 0, 0, 0.8),
        0 0 30px rgba(255, 102, 0, 0.8),
        0 0 40px rgba(255, 136, 0, 0.3);
    }
  }
  
  @keyframes titlePulse {
    0%, 100% {
      transform: scale(1);
      text-shadow: 
        0 2px 4px rgba(0, 0, 0, 0.8),
        0 0 15px rgba(255, 255, 255, 0.3);
    }
    50% {
      transform: scale(1.05);
      text-shadow: 
        0 2px 4px rgba(0, 0, 0, 0.8),
        0 0 25px rgba(255, 255, 255, 0.5);
    }
  }
  
  @keyframes subtitleShine {
    0%, 100% {
      text-shadow: 
        0 2px 4px rgba(0, 0, 0, 0.8),
        0 0 15px rgba(255, 204, 0, 0.5);
    }
    50% {
      text-shadow: 
        0 2px 4px rgba(0, 0, 0, 0.8),
        0 0 25px rgba(255, 204, 0, 0.8),
        0 0 35px rgba(255, 255, 0, 0.3);
    }
  }
  
  @keyframes badgePulse {
    0%, 100% {
      transform: scale(1);
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
    }
    50% {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(40, 167, 69, 0.6);
    }
  }
  
  @keyframes checkPulse {
    0%, 100% {
      transform: scale(1);
      opacity: 1;
    }
    50% {
      transform: scale(1.2);
      opacity: 0.8;
    }
  }
  
  @keyframes subtitleGlow {
    0%, 100% {
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
    }
    50% {
      text-shadow: 
        0 2px 4px rgba(0, 0, 0, 0.8),
        0 0 15px rgba(255, 255, 255, 0.4);
    }
  }
  
  @keyframes dotPulse {
    0%, 100% {
      transform: scale(1);
      opacity: 1;
    }
    50% {
      transform: scale(1.3);
      opacity: 0.7;
    }
  }
  
  @keyframes qualityFloat {
    0%, 100% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(-5px);
    }
  }
  
  @keyframes iconRotate {
    0%, 100% {
      transform: rotate(0deg) scale(1);
    }
    25% {
      transform: rotate(-5deg) scale(1.1);
    }
    75% {
      transform: rotate(5deg) scale(1.1);
    }
  }
  
  /* Responsive Animations for menu-title */
  @media (max-width: 768px) {
    .menu-title {
      padding: 40px 15px;
      margin-bottom: 30px;
    }
    
    .menu-title h1 {
      font-size: 2.5rem;
    }
    
    .menu-title::before,
    .menu-title::after {
      height: 40px;
    }
    
    .title-subtitle {
      font-size: 1rem;
    }
  }
  
  @media (max-width: 480px) {
    .menu-title h1 {
      font-size: 2rem;
    }
    
    .menu-title::before,
    .menu-title::after {
      height: 30px;
    }
    
    .title-subtitle {
      font-size: 0.9rem;
    }
  }

  /* ================================
     CATEGORY BUTTONS
     ================================ */
  .category-buttons {
    display: flex;
    justify-content: flex-start;
    gap: 12px;
    margin-bottom: 30px;
    flex-wrap: wrap;
    padding: 15px;
    background: #f8fafc;
    border-radius: 12px;
    border: 1px solid #e2e8f0;
  }

  .category-btn {
    padding: 10px 20px;
    border: 2px solid #e2e8f0;
    background: white;
    color: #4a5568;
    border-radius: 25px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .category-btn:hover,
  .category-btn.active {
    background: #4299e1;
    color: white;
    border-color: #4299e1;
  }

  .menu-section {
    margin-bottom: 40px;
  }

  .section-title {
    color: #2d3748;
    font-size: 2rem;
    font-weight: 600;
    margin-bottom: 20px;
    text-align: center;
  }

  .menu-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* Always 3 columns on desktop */
    gap: 30px;
    padding: 0;
    max-width: none;
  }
  
  /* Universal Responsive Design - Comprehensive Media Queries */
  
  /* Extra Large Screens (1920px and up) - Keep 3 columns */
  @media (min-width: 1920px) {
    .menu-grid {
      grid-template-columns: repeat(3, 1fr);
      gap: 40px;
    }
    .menu-item {
      min-height: 700px;
    }
    .item-image {
      height: 400px;
    }
  }
  
  /* Large Screens (1600px - 1919px) */
  @media (max-width: 1919px) and (min-width: 1600px) {
    .menu-grid {
      grid-template-columns: repeat(3, 1fr);
      gap: 45px;
    }
    .menu-item {
      min-height: 650px;
    }
    .item-image {
      height: 350px;
    }
  }
  
  /* Medium Large Screens (1400px - 1599px) */
  @media (max-width: 1599px) and (min-width: 1400px) {
    .menu-grid {
      grid-template-columns: repeat(3, 1fr);
      gap: 40px;
    }
    .menu-item {
      min-height: 600px;
    }
    .item-image {
      height: 320px;
    }
  }
  
  /* Medium Screens (1200px - 1399px) */
  @media (max-width: 1399px) and (min-width: 1200px) {
    .menu-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 35px;
    }
    .menu-item {
      min-height: 580px;
    }
    .item-image {
      height: 300px;
    }
    .content-area {
      margin-left: 300px;
      width: calc(100% - 300px);
    }
    .filter-sidebar {
      width: 260px;
    }
  }
  
  /* Small Medium Screens (992px - 1199px) */
  @media (max-width: 1199px) and (min-width: 992px) {
    .menu-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 30px;
    }
    .menu-item {
      min-height: 550px;
    }
    .item-image {
      height: 280px;
    }
    .content-area {
      margin-left: 280px;
      width: calc(100% - 280px);
    }
    .filter-sidebar {
      width: 250px;
      max-height: calc(100vh - 300px);
    }
  }
  
  /* Tablet Screens (768px - 991px) */
  @media (max-width: 991px) and (min-width: 768px) {
    .menu-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 25px;
    }
    .menu-item {
      min-height: 500px;
    }
    .item-image {
      height: 250px;
    }
    .item-content {
      padding: 20px;
    }
    .content-area {
      margin-left: 0;
      width: 100%;
    }
  }
  
  /* Mobile Large (576px - 767px) */
  @media (max-width: 767px) and (min-width: 576px) {
    .menu-grid {
      grid-template-columns: 1fr;
      gap: 20px;
    }
    .menu-item {
      min-height: 450px;
    }
    .item-image {
      height: 220px;
    }
    .item-content {
      padding: 18px;
    }
    .menu-title {
      font-size: 2.5rem;
    }
    .menu-title::before,
    .menu-title::after {
      display: none; /* Hide shoe icons on mobile */
    }
  }
  
  /* Mobile Medium (480px - 575px) */
  @media (max-width: 575px) and (min-width: 480px) {
    .menu-grid {
      grid-template-columns: 1fr;
      gap: 18px;
    }
    .menu-item {
      min-height: 420px;
    }
    .item-image {
      height: 200px;
    }
    .item-content {
      padding: 16px;
    }
    .menu-title {
      font-size: 2.2rem;
    }
    .category-btn {
      font-size: 0.8rem;
      padding: 8px 16px;
    }
  }
  
  /* Mobile Small (up to 479px) */
  @media (max-width: 479px) {
    .menu-grid {
      grid-template-columns: 1fr;
      gap: 15px;
    }
    .menu-item {
      min-height: 380px;
    }
    .item-image {
      height: 180px;
    }
    .item-content {
      padding: 15px;
    }
    .menu-title {
      font-size: 2rem;
    }
    .category-buttons {
      padding: 10px;
      gap: 8px;
    }
    .category-btn {
      font-size: 0.75rem;
      padding: 6px 12px;
    }
    .item-name {
      font-size: 1.2rem;
    }
    .item-price {
      font-size: 1.1rem;
    }
  }

  .menu-item {
    background: rgba(255, 255, 255, 0.98);
    border-radius: 24px;
    box-shadow: 0 12px 35px rgba(0, 0, 0, 0.12);
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    position: relative;
    min-height: 650px; /* Increased from 500px to 650px */
    display: flex;
    flex-direction: column;
    border: 2px solid transparent;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .menu-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
  }

  .item-image {
    height: 350px; /* Increased from 280px to 350px */
    overflow: hidden;
    position: relative;
    background: linear-gradient(135deg, #f8fafc 0%, #edf2f7 100%);
  }

  .item-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .menu-item:hover .item-image img {
    transform: scale(1.05);
  }

  /* Sevimli button chap tepa burchakda */
  .favorite-form {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 10;
  }

  .btn-favorite-top {
    background: rgba(255, 255, 255, 0.9);
    color: #e91e63;
    border: none;
    padding: 8px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  .btn-favorite-top:hover {
    background: #e91e63;
    color: white;
    transform: scale(1.1);
  }

  .item-content {
    padding: 30px; /* Increased from 25px */
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .item-name {
    color: #2d3748;
    font-size: 1.4rem;
    font-weight: 600;
    margin-bottom: 10px;
  }

  .item-description {
    color: #718096;
    margin-bottom: 15px;
    line-height: 1.5;
    font-size: 0.9rem;
  }

  .rating-section {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
  }

  .stars {
    display: flex;
    gap: 2px;
  }

  .star {
    font-size: 16px;
    color: #ddd;
    transition: color 0.3s ease;
  }

  .star.filled {
    color: #ffd700;
  }

  .rating-text {
    font-size: 0.8rem;
    color: #666;
  }

  .item-footer {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .price-section {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .item-price {
    color: #38a169;
    font-size: 1.3rem;
    font-weight: 700;
  }

  .price-with-discount {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
  }

  .original-price {
    color: #999;
    text-decoration: line-through;
    font-size: 0.9em;
  }

  .discount-price {
    color: #28a745;
    font-weight: bold;
    font-size: 1.3em;
  }

  .discount-badge {
    background: #dc3545;
    color: white;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.8em;
    font-weight: bold;
  }

  /* Miqdor va savatcha controls */
  .add-to-cart-section {
    display: flex;
    justify-content: center;
  }

  .quantity-cart-controls {
    display: flex;
    align-items: center;
    gap: 5px;
    background: #f8f9fa;
    border-radius: 25px;
    padding: 5px;
    border: 2px solid #e2e8f0;
  }

  .quantity-btn {
    background: #4299e1;
    color: white;
    border: none;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .quantity-btn:hover {
    background: #3182ce;
    transform: scale(1.1);
  }

  .quantity-input {
    border: none;
    background: transparent;
    text-align: center;
    font-weight: bold;
    width: 40px;
    font-size: 16px;
    color: #2d3748;
  }

  .btn-cart {
    background: #38a169;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s ease;
    margin-left: 5px;
  }

  .btn-cart:hover {
    background: #2f855a;
    transform: scale(1.05);
  }

  /* Baholash tugmasi stillari */
  .rating-button-section {
    display: flex;
    justify-content: center;
    margin-top: 10px;
  }

  .btn-rate {
    background: linear-gradient(135deg, #ffd700 0%, #ffa500 100%);
    color: #333;
    border: none;
    padding: 8px 15px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(255, 215, 0, 0.3);
  }

  .btn-rate:hover {
    background: linear-gradient(135deg, #ffa500 0%, #ff8c00 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(255, 165, 0, 0.4);
  }

  /* Modal stillari */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    display: none;
    align-items: center;
    justify-content: center;
    overflow-y: auto;
  }

  .modal-content {
    background: white;
    border-radius: 15px;
    max-width: 90vw;
    max-height: 90vh;
    width: 600px;
    overflow-y: auto;
    position: relative;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  }

  /* Tungi rejim uchun modal tuzatishlari */
  body.dark-theme .modal-content {
    background: #1a1a1a !important;
    color: #ffffff !important;
    border: 1px solid #3d3d3d !important;
  }

  body.dark-theme .modal-header {
    background: #2d2d2d !important;
    color: #ffffff !important;
    border-bottom-color: #3d3d3d !important;
  }

  body.dark-theme .modal-header h2 {
    color: #ffffff !important;
  }

  body.dark-theme .modal-close:hover {
    background: #3d3d3d !important;
    color: #ffffff !important;
  }

  body.dark-theme .modal-details p {
    color: #e0e0e0 !important;
  }

  body.dark-theme .comments-section h3 {
    color: #ffffff !important;
  }

  body.dark-theme .comment-item {
    background: #2d2d2d !important;
    color: #ffffff !important;
    border-color: #3d3d3d !important;
  }

  body.dark-theme .comment-text {
    color: #e0e0e0 !important;
  }

  body.dark-theme .quantity-selector button {
    background: #2d2d2d !important;
    color: #ffffff !important;
  }

  body.dark-theme .quantity-selector button:hover {
    background: #4299e1 !important;
    color: #ffffff !important;
  }

  body.dark-theme .quantity-selector input {
    background: #2d2d2d !important;
    color: #ffffff !important;
    border-color: #3d3d3d !important;
  }

  .modal-header {
    padding: 20px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f8f9fa;
    border-radius: 15px 15px 0 0;
  }

  .modal-header h2 {
    margin: 0;
    color: #2d3748;
  }

  .modal-close {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #666;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.3s ease;
  }

  .modal-close:hover {
    background: #f0f0f0;
    color: #333;
  }

  .modal-body {
    padding: 20px;
  }

  .modal-image {
    margin-bottom: 20px;
    text-align: center;
  }

  .modal-image img {
    max-width: 100%;
    max-height: 300px;
    border-radius: 10px;
    object-fit: cover;
  }

  .modal-details p {
    font-size: 1rem;
    line-height: 1.6;
    color: #555;
    margin-bottom: 15px;
  }

  .modal-rating {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
  }

  .modal-price {
    font-size: 1.5rem;
    font-weight: bold;
    color: #38a169;
    margin-bottom: 20px;
    text-align: center;
  }

  .modal-actions {
    border-top: 1px solid #eee;
    padding-top: 20px;
    margin-bottom: 20px;
  }

  .quantity-selector {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
    justify-content: center;
  }

  .quantity-selector button {
    background: #f0f0f0;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 18px;
    font-weight: bold;
    transition: all 0.3s ease;
  }

  .quantity-selector button:hover {
    background: #4299e1;
    color: white;
  }

  .quantity-selector input {
    width: 60px;
    text-align: center;
    border: 2px solid #e2e8f0;
    border-radius: 5px;
    padding: 8px;
    font-size: 16px;
  }

  .btn-add-cart {
    width: 100%;
    background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
    color: white;
    border: none;
    padding: 15px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    font-size: 1rem;
    transition: all 0.3s ease;
  }

  .btn-add-cart:hover {
    background: linear-gradient(135deg, #3182ce 0%, #2c5282 100%);
    transform: translateY(-2px);
  }

  .comments-section {
    border-top: 1px solid #eee;
    padding-top: 20px;
  }

  .comments-section h3 {
    margin-bottom: 15px;
    color: #2d3748;
  }

  .comments-list {
    max-height: 200px;
    overflow-y: auto;
  }

  .comment-item {
    padding: 10px;
    border: 1px solid #eee;
    border-radius: 8px;
    margin-bottom: 10px;
    background: #f8f9fa;
  }

  .comment-author {
    font-weight: bold;
    color: #4299e1;
    margin-bottom: 5px;
  }

  .comment-text {
    color: #555;
    font-size: 0.9rem;
  }

  /* Baho berish modal stillari */
  .rating-modal {
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1001; /* Ensure it's above the item modal */
  }

  .rating-modal-content {
    background: white;
    border-radius: 15px;
    width: 450px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    position: relative;
  }

  /* Tungi rejim uchun rating modal */
  body.dark-theme .rating-modal-content {
    background: #1a1a1a !important;
    color: #ffffff !important;
    border: 1px solid #3d3d3d !important;
  }

  body.dark-theme .rating-modal-header {
    background: #2d2d2d !important;
    color: #ffffff !important;
    border-bottom-color: #3d3d3d !important;
  }

  body.dark-theme .rating-modal-body {
    background: #1a1a1a !important;
    color: #ffffff !important;
  }

  /* Menu item cards uchun tungi rejim */
  body.dark-theme .menu-item {
    background: #1a1a1a !important;
    color: #ffffff !important;
    border: 1px solid #3d3d3d !important;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.6) !important;
  }

  body.dark-theme .menu-item:hover {
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.8) !important;
  }

  body.dark-theme .item-title {
    color: #ffffff !important;
  }

  body.dark-theme .item-description {
    color: #e0e0e0 !important;
  }

  body.dark-theme .item-price {
    color: #66b3ff !important;
  }

  body.dark-theme .item-rating {
    color: #e0e0e0 !important;
  }

  /* Filter sidebar uchun qo'shimcha tungi rejim */
  body.dark-theme .filter-item {
    background: #2d2d2d !important;
    color: #ffffff !important;
    border-color: #3d3d3d !important;
  }

  body.dark-theme .filter-title {
    color: #ffffff !important;
  }

  body.dark-theme .category-btn {
    background: #2d2d2d !important;
    color: #ffffff !important;
    border-color: #3d3d3d !important;
  }

  body.dark-theme .category-btn.active {
    background: #4299e1 !important;
    border-color: #4299e1 !important;
    color: #ffffff !important;
  }

  .rating-modal-header {
    padding: 20px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f8f9fa;
    border-radius: 15px 15px 0 0;
  }

  .rating-modal-header h3 {
    margin: 0;
    color: #2d3748;
    font-size: 1.2rem;
  }

  .rating-modal-body {
    padding: 20px;
    text-align: center;
  }

  .rating-item-info {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 20px;
    border-bottom: 1px solid #eee;
    padding-bottom: 15px;
    justify-content: center;
  }

  .rating-item-image {
    width: 60px;
    height: 60px;
    border-radius: 8px;
    object-fit: cover;
  }

  .rating-item-name {
    font-size: 1.2rem;
    font-weight: 600;
    color: #2d3748;
  }

  .rating-form h4 {
    margin-bottom: 15px;
    color: #4a5568;
    font-size: 1.1rem;
  }

  .stars-rating {
    display: flex;
    justify-content: center;
    gap: 5px;
    margin-bottom: 20px;
  }

  .rating-star {
    font-size: 30px;
    color: #ddd;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .rating-star:hover {
    color: #ffd700;
    transform: scale(1.2);
  }

  .rating-form textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 1rem;
    resize: vertical;
    box-sizing: border-box; /* Ensure padding is included in width */
    margin-bottom: 20px;
  }

  .btn-submit-rating {
    background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    font-size: 1rem;
    transition: all 0.3s ease;
  }

  .btn-submit-rating:hover {
    background: linear-gradient(135deg, #2f855a 0%, #276749 100%);
    transform: translateY(-2px);
  }

  /* Floating Cart Icon */
  {# .floating-cart-icon {
    position: fixed;
    bottom: 220px; /* Raised above news ticker area */
    right: 20px; /* Moved to right side */
    background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
    width: 70px;
    height: 70px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 8px 30px rgba(56, 161, 105, 0.6);
    z-index: 101; /* Above news ticker (100) but below navbar (1050) */
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 3px solid rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .floating-cart-icon:hover {
    transform: scale(1.15);
    box-shadow: 0 8px 30px rgba(56, 161, 105, 0.7);
    animation: bounceCart 0.6s ease-in-out;
  } #}

  .cart-icon {
    font-size: 26px;
    color: white;
    animation: wiggle 2s ease-in-out infinite;
  }

  @keyframes bounceCart {
    0%,
    100% {
      transform: scale(1.15);
    }
    50% {
      transform: scale(1.25);
    }
  }

  @keyframes wiggle {
    0%,
    100% {
      transform: rotate(0deg);
    }
    25% {
      transform: rotate(-5deg);
    }
    75% {
      transform: rotate(5deg);
    }
  }

  .cart-badge-floating {
    position: absolute;
    top: 0px;
    right: 0px;
    background-color: #e53e3e;
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
    transform: scale(0);
    transition: transform 0.3s ease-in-out;
  }

  .cart-badge-floating.show {
    transform: scale(1);
    animation: pulseCartBadge 1s ease-in-out infinite;
  }

  @keyframes pulseCartBadge {
    0%,
    100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.1);
    }
  }

  /* ================================
     ANIMATIONS
     ================================ */
  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  
  /* Mobile responsiv uchun floating cart */
  
  /* ================================
     ENHANCED MODAL OPTIONS STYLING
     ================================ */
  .modal-options-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin: 20px 0;
    padding: 20px;
    background: linear-gradient(135deg, #f8fafc 0%, #edf2f7 100%);
    border-radius: 16px;
    border: 1px solid #e2e8f0;
  }
  
  .modal-option-group {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  
  .modal-option-label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
    color: #2d3748;
    font-size: 1rem;
    margin-bottom: 8px;
  }
  
  .option-icon {
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 8px;
    color: white;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
  }
  
  .option-text {
    font-size: 1rem;
    color: #4a5568;
  }
  
  .select-wrapper {
    position: relative;
    display: flex;
    align-items: center;
  }
  
  .modal-select {
    width: 100%;
    padding: 14px 50px 14px 16px;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    background: white;
    color: #2d3748;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
  }
  
  .modal-select:focus {
    outline: none;
    border-color: #4299e1;
    box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1), 0 4px 12px rgba(0, 0, 0, 0.08);
    transform: translateY(-1px);
  }
  
  .modal-select:hover {
    border-color: #cbd5e0;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.06);
  }
  
  .select-arrow {
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: #718096;
    font-size: 0.75rem;
    pointer-events: none;
    transition: transform 0.3s ease;
  }
  
  .modal-select:focus + .select-arrow {
    transform: translateY(-50%) rotate(180deg);
    color: #4299e1;
  }
  
  /* Special styling for when options are selected */
  .modal-select:not([value=""]) {
    background: linear-gradient(135deg, #f0fff4 0%, #e6fffa 100%);
    border-color: #38a169;
    color: #2f855a;
    font-weight: 600;
  }
  
  .modal-select:not([value=""]):focus {
    border-color: #38a169;
    box-shadow: 0 0 0 3px rgba(56, 161, 105, 0.1), 0 4px 12px rgba(0, 0, 0, 0.08);
  }
  
  /* Beautiful option styling */
  .modal-select option {
    padding: 12px;
    background: white;
    color: #2d3748;
    font-weight: 500;
  }
  
  .modal-select option:checked {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
  }
  
  /* Color indicator styling */
  .color-option {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
  }
  
  .color-indicator {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 2px solid #e2e8f0;
    display: inline-block;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    flex-shrink: 0;
  }
  
  /* Predefined color styles */
  .color-indicator.black { background: #000000; border-color: #374151; }
  .color-indicator.white { background: #ffffff; border-color: #d1d5db; }
  .color-indicator.blue { background: #3b82f6; border-color: #1d4ed8; }
  .color-indicator.red { background: #ef4444; border-color: #dc2626; }
  .color-indicator.green { background: #10b981; border-color: #059669; }
  .color-indicator.yellow { background: #f59e0b; border-color: #d97706; }
  .color-indicator.brown { background: #92400e; border-color: #78350f; }
  .color-indicator.gray { background: #6b7280; border-color: #4b5563; }
  .color-indicator.pink { background: #ec4899; border-color: #db2777; }
  .color-indicator.purple { background: #8b5cf6; border-color: #7c3aed; }
  .color-indicator.orange { background: #f97316; border-color: #ea580c; }
  .color-indicator.navy { background: #1e3a8a; border-color: #1e40af; }
  .color-indicator.maroon { background: #7f1d1d; border-color: #991b1b; }
  .color-indicator.beige { background: #fef3c7; border-color: #f59e0b; }
  
  /* Responsive adjustments for modal options */
  @media (max-width: 768px) {
    .modal-options-container {
      padding: 16px;
      gap: 16px;
    }
    
    .modal-select {
      padding: 12px 45px 12px 14px;
      font-size: 0.9rem;
    }
    
    .option-icon {
      width: 28px;
      height: 28px;
      font-size: 1rem;
    }
    
    .color-indicator {
      width: 16px;
      height: 16px;
    }
  }
  
  /* Enhanced menu items */
  .menu-item {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 2px solid transparent;
  }
  
  .menu-item:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    border-color: #4299e1;
  }
  
  .menu-item .item-image img {
    transition: all 0.3s ease;
  }
  
  .menu-item:hover .item-image img {
    transform: scale(1.05);
  }
  
  /* Enhanced category buttons */
  .category-btn {
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
  }
  
  .category-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
  }
  
  .category-btn:hover::before {
    left: 100%;
  }
  
  .category-btn.active {
    box-shadow: 0 0 20px rgba(66, 153, 225, 0.4);
  }
  
  /* Enhanced filter sidebar */
  .filter-sidebar::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 5px;
    background: linear-gradient(90deg, #667eea, #764ba2);
    border-radius: 12px 12px 0 0;
  }
  
  @media (max-width: 768px) {
    .floating-cart-icon {
      width: 55px;
      height: 55px;
      bottom: 140px; /* Above mobile news ticker */
      right: 15px;
      box-shadow: 0 4px 20px rgba(56, 161, 105, 0.4);
    }

    .cart-icon {
      font-size: 22px;
    }

    .cart-badge-floating {
      width: 18px;
      height: 18px;
      font-size: 11px;
      top: -3px;
      right: -3px;
    }
  }

  /* Mobile and Tablet Universal Responsive Updates */
  @media (max-width: 991px) {
    .main-content {
      flex-direction: column;
      gap: 20px;
    }

    .filter-sidebar {
      width: 100%;
      position: fixed;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      padding: 20px;
      max-height: 100vh;
      z-index: 1049;
      background: white;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      border-radius: 0;
      overflow-y: auto;
      box-shadow: 2px 0 20px rgba(0, 0, 0, 0.3);
    }
    
    .filter-sidebar.show {
      transform: translateX(0);
    }
    
    .content-area {
      width: 100% !important;
      margin-left: 0 !important;
      padding: 0 15px;
    }

    .filter-title {
      font-size: 1.3rem;
      margin-bottom: 25px;
      text-align: center;
      color: #2d3748;
      padding-bottom: 15px;
      border-bottom: 2px solid #e2e8f0;
    }

    .category-buttons {
      justify-content: center;
      padding: 15px;
      flex-wrap: wrap;
    }

    .category-btn {
      font-size: 0.9rem;
      padding: 10px 18px;
      margin: 5px;
    }

    .modal-content {
      width: 95vw;
      max-width: 500px;
      margin: 20px auto;
    }

    .quantity-cart-controls {
      justify-content: center;
    }

    .rating-modal-content {
      width: 95vw;
      max-width: 450px;
    }
    
    /* Mobile filter toggle improvements */
    .mobile-filter-toggle {
      position: sticky;
      top: 20px;
      z-index: 100;
      margin-bottom: 25px;
      font-size: 1.1rem;
      padding: 15px 25px;
    }

    /* Mobile va tablet uchun tungi rejim tuzatishlari */
    body.dark-theme .mobile-filter-toggle {
      background: #4299e1 !important;
      color: #ffffff !important;
      border-color: #4299e1 !important;
    }

    body.dark-theme .mobile-filter-toggle:hover {
      background: #3182ce !important;
    }

    /* Mobile menuda tungi rejim */
    body.dark-theme .menu-grid .menu-item {
      background: #1a1a1a !important;
      color: #ffffff !important;
      border-color: #3d3d3d !important;
    }

    /* Responsive kartalar uchun tungi rejim shadow */
    body.dark-theme .menu-item {
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.8) !important;
    }
  }

  /* Toast notification styles */
  .toast-notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #48bb78; /* Default to success */
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    z-index: 1050;
    opacity: 0;
    transform: translateY(-100%);
    transition: opacity 0.3s ease, transform 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 500;
  }

  .toast-notification.show {
    opacity: 1;
    transform: translateY(0);
  }

  .toast-content {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .toast-icon {
    font-size: 18px;
  }

  .toast-message {
    font-size: 0.95rem;
  }

  .toast-success {
    background-color: #48bb78;
  }
  .toast-error {
    background-color: #f56565;
  }
  .toast-info {
    background-color: #4299e1;
  }
  .toast-warning {
    background-color: #ed8936;
  }

  /* Toast notification uchun tungi rejim */
  body.dark-theme .toast-notification {
    background-color: #2d2d2d !important;
    color: #ffffff !important;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.8) !important;
    border: 1px solid #3d3d3d !important;
  }

  body.dark-theme .toast-success {
    background-color: #38a169 !important;
  }

  body.dark-theme .toast-error {
    background-color: #e53e3e !important;
  }

  body.dark-theme .toast-info {
    background-color: #3182ce !important;
  }

  body.dark-theme .toast-warning {
    background-color: #d69e2e !important;
  }
</style>

<script>
  let menuData = {
    // Faqat erkaklar uchun mahsulotlar - ayollar bo'limi olib tashlandi
    {% for item in men %}
    {{ item.id }}: {
      name: "{{ item.name }}",
      description: "{{ item.description or 'Mahsulot tavsifi' }}",
      image: "{{ item.image_url or '/static/images/default-men.jpg' }}",
      rating: {{ item.rating or 0 }},
      orders_count: {{ item.orders_count or 0 }},
      sizes: "{{ item.sizes or '' }}",
      colors: "{{ item.colors or '' }}"
    },
    {% endfor %}
  };

  function showCategory(category) {
      const items = document.querySelectorAll('.menu-item');
      const buttons = document.querySelectorAll('.category-btn');

      // Tugmalarni yangilash
      buttons.forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');

      // Mahsulotlarni ko'rsatish/yashirish
      items.forEach(item => {
          const itemCategory = item.dataset.category || 'product';
          if (category === 'all' || itemCategory === category) {
              item.style.display = 'block';
          } else {
              item.style.display = 'none';
          }
      });

      // Filter kategoriyasini ham yangilash
      const categorySelect = document.getElementById('filterCategory');
      if (categorySelect && category !== 'all') {
          categorySelect.value = category;
      }
  }

  function openItemModal(itemId) {
      const item = menuData[itemId];
      if (!item) return;

      // Modal ma'lumotlarini to'ldirish
      document.getElementById('modalTitle').textContent = item.name;
      document.getElementById('modalImage').src = item.image;
      document.getElementById('modalDescription').textContent = item.description;
      document.getElementById('modalItemId').value = itemId;

      // Baholarni ko'rsatish
      const modalStars = document.getElementById('modalStars');
      modalStars.innerHTML = '';
      for (let i = 1; i <= 5; i++) {
          const star = document.createElement('span');
          star.className = `star ${i <= item.rating ? 'filled' : ''}`;
          star.textContent = '‚≠ê';
          modalStars.appendChild(star);
      }
      document.getElementById('modalRatingText').textContent = `${item.rating.toFixed(1)} (${item.orders_count} buyurtma)`;


      // Sharhlarni yuklash
      loadComments(itemId);

      // Populate size and color selects
      const sizeSelect = document.getElementById('modalSize');
      const colorSelect = document.getElementById('modalColor');
      // clear previous options (keep the first placeholder)
      if (sizeSelect) {
          sizeSelect.querySelectorAll('option:not(:first-child)').forEach(o => o.remove());
          const sizes = (item.sizes || '').split(',').map(s => s.trim()).filter(s => s.length);
          sizes.forEach(sz => {
              const opt = document.createElement('option');
              opt.value = sz;
              opt.textContent = sz;
              sizeSelect.appendChild(opt);
          });
      }
      if (colorSelect) {
          colorSelect.querySelectorAll('option:not(:first-child)').forEach(o => o.remove());
          const colors = (item.colors || '').split(',').map(s => s.trim()).filter(s => s.length);
          colors.forEach(clr => {
              const opt = document.createElement('option');
              opt.value = clr;
              opt.textContent = getColorDisplayName(clr);
              colorSelect.appendChild(opt);
          });
          
          // Add color indicators to options
          addColorIndicators(colorSelect, colors);
      }

    // Modalni ko'rsatish via centralized helper (keeps behavior consistent)
    if (typeof showItemModal === 'function') {
      showItemModal();
    } else {
      // Fallback if helper isn't available for some reason
      document.getElementById('itemModal').style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }

    // If product has sizes/colors, mark selects as required so client validation
    // can enable/disable the Add button accordingly. Also attach change listeners
    // that toggle the modal Add button state.
    try {
      const addBtn = document.getElementById('modalAddToCartBtn');
      // derive presence of sizes/colors from the item data (safe across scopes)
      const hasSizes = (item && (item.sizes || '').toString().trim().length > 0);
      const hasColors = (item && (item.colors || '').toString().trim().length > 0);

      if (sizeSelect) {
        sizeSelect.dataset.required = hasSizes ? 'true' : 'false';
      }
      if (colorSelect) {
        colorSelect.dataset.required = hasColors ? 'true' : 'false';
      }

      function evaluateModalAddButton() {
        // Determine whether required options were selected
        const needSize = sizeSelect && sizeSelect.dataset.required === 'true';
        const needColor = colorSelect && colorSelect.dataset.required === 'true';
        const sizeVal = sizeSelect ? (sizeSelect.value || '') : '';
        const colorVal = colorSelect ? (colorSelect.value || '') : '';

        const enabled = (!needSize || (sizeVal && sizeVal.length > 0)) && (!needColor || (colorVal && colorVal.length > 0));
        if (addBtn) {
          addBtn.disabled = !enabled;
          if (enabled) addBtn.classList.remove('disabled');
          else addBtn.classList.add('disabled');
        }
      }

      // Attach listeners (idempotent - remove then add)
      if (sizeSelect) {
        sizeSelect.removeEventListener('change', evaluateModalAddButton);
        sizeSelect.addEventListener('change', evaluateModalAddButton);
      }
      if (colorSelect) {
        colorSelect.removeEventListener('change', evaluateModalAddButton);
        colorSelect.addEventListener('change', evaluateModalAddButton);
      }

      // Initial evaluation (in case product has no required options)
      evaluateModalAddButton();
    } catch (e) {
      console.warn('Modal add button evaluation error:', e);
    }
  }

  function closeItemModal() {
      // Use centralized helper to hide modal so behavior is consistent
      if (typeof hideItemModal === 'function') {
        hideItemModal();
      } else {
        document.getElementById('itemModal').style.display = 'none';
        document.body.style.overflow = 'auto';
      }
  }

  // --------- Menu search & filter helpers ----------
  function debounce(fn, wait) {
    let t = null;
    return function(...args) {
      clearTimeout(t);
      t = setTimeout(() => fn.apply(this, args), wait);
    };
  }

  function renderMenuItems(items) {
    const grid = document.querySelector('.menu-grid');
    if (!grid) return;
    grid.innerHTML = '';

    items.forEach(item => {
      const div = document.createElement('div');
      div.className = 'menu-item';
      div.dataset.category = item.category || 'product';
      div.onclick = () => openItemModal(item.id);

      div.innerHTML = `
        <div class="item-image"><img src="${item.image_url || '/static/images/default-product.jpg'}" alt="${item.name}" onerror="this.src='/static/images/default-product.jpg'"/></div>
        <div class="item-content">
          <h3 class="item-name">${item.name}</h3>
          <p class="item-description">${item.description || ''}</p>
          <div class="rating-section"><div class="stars">${'<span class="star">‚≠ê</span>'.repeat(5)}</div><span class="rating-text">${(parseFloat(item.rating)||0).toFixed(1)} (${item.orders_count||0} buyurtma)</span></div>
          <div class="item-footer">
            <div class="add-to-cart-section">
              <form method="POST" action="/add_to_cart" onclick="event.stopPropagation()">
                <input type="hidden" name="menu_item_id" value="${item.id}" />
                <div class="quantity-cart-controls">
                  <button type="button" class="quantity-btn minus" onclick="decreaseQuantity(this)">‚àí</button>
                  <input type="number" name="quantity" value="1" min="1" max="99" class="quantity-input" />
                  <button type="button" class="quantity-btn plus" onclick="increaseQuantity(this)">+</button>
                  <button type="submit" class="btn-cart">üõí</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      `;

      grid.appendChild(div);
    });
  }

  async function performMenuSearch() {
    const q = document.getElementById('menuSearchInput').value.trim();
    const category = document.getElementById('filterCategory').value;
    const sort = document.getElementById('filterSort').value;
    const size = document.getElementById('filterSize').value.trim();
    const color = document.getElementById('filterColor').value.trim();

    const params = new URLSearchParams();
    if (q) params.set('q', q);
    if (category) params.set('category', category);
    if (sort) params.set('sort', sort);
    if (size) params.set('size', size);
    if (color) params.set('color', color);

    try {
      const res = await fetch('/api/menu-search?' + params.toString());
      const data = await res.json();
      if (data && data.success && Array.isArray(data.items)) {
        renderMenuItems(data.items);
        // Update local menuData cache for modal interactions
        menuData = {};
        data.items.forEach(it => { menuData[it.id] = it; });
      } else {
        // Fallback to client-side filtering if API fails
        applyClientSideFilter();
      }
    } catch (e) {
      console.warn('Search API failed, using client-side filter', e);
      applyClientSideFilter();
    }
  }

  function applyClientSideFilter() {
    const q = document.getElementById('menuSearchInput').value.trim().toLowerCase();
    const category = document.getElementById('filterCategory').value;
    const size = document.getElementById('filterSize').value.trim().toLowerCase();
    const color = document.getElementById('filterColor').value.trim().toLowerCase();

    const allItems = Object.values(menuData || {});
    const filtered = allItems.filter(it => {
      if (category && it.category !== category) return false;
      if (q && !(it.name.toLowerCase().includes(q) || (it.description||'').toLowerCase().includes(q))) return false;
      if (size && !(it.sizes||'').toLowerCase().split(',').map(s=>s.trim()).includes(size)) return false;
      if (color && !(it.colors||'').toLowerCase().split(',').map(s=>s.trim()).includes(color)) return false;
      return true;
    });
    renderMenuItems(filtered);
  }

  const debouncedSearch = debounce(performMenuSearch, 300);

  // Wire inputs
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('menuSearchInput');
    const categorySelect = document.getElementById('filterCategory');
    const sortSelect = document.getElementById('filterSort');
    const sizeInput = document.getElementById('filterSize');
    const colorInput = document.getElementById('filterColor');
    const clearBtn = document.getElementById('clearFiltersBtn');

    if (searchInput) searchInput.addEventListener('input', debouncedSearch);
    if (categorySelect) categorySelect.addEventListener('change', debouncedSearch);
    if (sortSelect) sortSelect.addEventListener('change', debouncedSearch);
    if (sizeInput) sizeInput.addEventListener('input', debouncedSearch);
    if (colorInput) colorInput.addEventListener('input', debouncedSearch);
    if (clearBtn) clearBtn.addEventListener('click', function() {
      searchInput.value = '';
      categorySelect.value = '';
      sortSelect.value = '';
      sizeInput.value = '';
      colorInput.value = '';
      // reload original menu by triggering search (empty)
      debouncedSearch();
    });
  });

  function increaseModalQuantity() {
      const input = document.getElementById('modalQuantity');
      const currentValue = parseInt(input.value) || 1;
      if (currentValue < 99) {
          input.value = currentValue + 1;
      }
  }

  function decreaseModalQuantity() {
      const input = document.getElementById('modalQuantity');
      const currentValue = parseInt(input.value) || 1;
      if (currentValue > 1) {
          input.value = currentValue - 1;
      }
  }

  function increaseQuantity(button) {
      const input = button.parentElement.querySelector('input[name="quantity"]');
      if (input) {
          let currentValue = parseInt(input.value) || 1;
          if (currentValue < 99) {
              input.value = currentValue + 1;
          }
      }
  }

  function decreaseQuantity(button) {
      const input = button.parentElement.querySelector('input[name="quantity"]');
      if (input) {
          let currentValue = parseInt(input.value) || 1;
          if (currentValue > 1) {
              input.value = currentValue - 1;
          }
      }
  }

  function loadComments(itemId) {
      // Serverdan haqiqiy sharhlarni yuklash
      fetch(`/api/get-menu-ratings/${itemId}`)
          .then(response => response.json())
          .then(data => {
              const commentsContainer = document.getElementById('modalComments');

              if (data.success && data.ratings && data.ratings.length > 0) {
                  let commentsHtml = '';
                  data.ratings.forEach(rating => {
                      commentsHtml += `
                          <div class="comment-item">
                              <div class="comment-author">${rating.user_name} - ${'‚≠ê'.repeat(rating.rating)}</div>
                              <div class="comment-text">${rating.comment || 'Sharh qoldirilmagan'}</div>
                              <div class="comment-date">${rating.created_at}</div>
                          </div>
                      `;
                  });
                  commentsContainer.innerHTML = commentsHtml;
              } else {
                  commentsContainer.innerHTML = `
                      <div class="no-comments">
                          <p style="text-align: center; color: #888; font-style: italic;">
                              Hali hech kim sharh qoldirmagan. Birinchi bo'lib baholang! ‚≠ê
                          </p>
                      </div>
                  `;
              }
          })
          .catch(error => {
              console.error('Sharhlarni yuklashda xatolik:', error);
              const commentsContainer = document.getElementById('modalComments');
              commentsContainer.innerHTML = `
                  <div class="error-message">
                      <p style="text-align: center; color: #e53e3e;">
                          Sharhlarni yuklashda xatolik yuz berdi.
                      </p>
                  </div>
              `;
          });
  }

  /* ESC tugmasi bilan modalni yopish */
  document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
          closeItemModal();
          closeRatingModal();
      }
  });

  // Sahifa yuklangandan keyin cart sonini yangilash
      window.addEventListener('DOMContentLoaded', function() {
          try {
              updateCartCountDisplay();
              updateFloatingCartIcon();
          } catch (error) {
              console.error('DOMContentLoaded da xatolik:', error);
          }
      });

      // Floating cart iconini yangilash
      function updateFloatingCartIcon() {
          fetch('/api/cart-count')
          .then(response => response.json())
          .then(data => {
              const floatingCartBadge = document.getElementById('cart-badge-floating');
              const floatingCart = document.getElementById('floating-cart');

              if (floatingCartBadge && floatingCart) {
                  floatingCartBadge.textContent = data.count || 0;

                  if (data.count > 0) {
                      floatingCartBadge.classList.add('show');
                      floatingCart.style.display = 'flex';
                  } else {
                      floatingCartBadge.classList.remove('show');
                      // Cart bo'sh bo'lsa ham iconni ko'rsatish, faqat badge yashirish
                      floatingCart.style.display = 'flex';
                  }
              }
          })
          .catch(error => {
              console.error('Cart count olishda xatolik:', error);
          });
      }

    // Unified addToCartAjax: always include optional size/color when provided
    function addToCartAjax(menuItemId, quantity = 1, size = '', color = '') {
      console.log('Adding to cart (ajax):', menuItemId, quantity, size, color);

      const payload = {
        menu_item_id: parseInt(menuItemId),
        quantity: parseInt(quantity)
      };
      if (size !== undefined && size !== null && String(size).length > 0) payload.size = size;
      if (color !== undefined && color !== null && String(color).length > 0) payload.color = color;

      return fetch('/add_to_cart', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-Requested-With': 'XMLHttpRequest'
        },
        body: JSON.stringify(payload)
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showToast('Mahsulot savatchaga qo\'shildi! üõí', 'success');
          updateCartCountDisplay();

          if (data.cart_count !== undefined) {
            const cartCountElements = document.querySelectorAll('#cart-count, #cart-badge-floating, .cart-badge');
            cartCountElements.forEach(element => {
              element.textContent = data.cart_count;
              if (data.cart_count > 0) {
                element.style.display = 'inline-block';
                element.classList.add('show');
              } else {
                element.style.display = 'none';
                element.classList.remove('show');
              }
            });
          }
        } else {
          showToast(data.message || 'Xatolik yuz berdi', 'error');
        }
        return data;
      })
      .catch(error => {
        console.error('Add to cart error:', error);
        showToast('Savatchaga qo\'shishda xatolik yuz berdi', 'error');
        throw error;
      });
    }

      // Toast notification funksiyasi
      function showToast(message, type = 'info') {
        try {
          // Ensure a persistent container exists so CSS stacking is predictable
          let container = document.getElementById('toast-container');
          if (!container) {
            container = document.createElement('div');
            container.id = 'toast-container';
            // high z-index to appear above modals and overlays
            container.style.position = 'fixed';
            container.style.top = '20px';
            container.style.right = '20px';
            container.style.zIndex = '3000';
            container.style.display = 'flex';
            container.style.flexDirection = 'column';
            container.style.gap = '10px';
            document.body.appendChild(container);
          }

          const toast = document.createElement('div');
          toast.className = `toast-notification toast-${type}`;
          toast.style.pointerEvents = 'auto';
          toast.innerHTML = `
            <div class="toast-content">
              <span class="toast-icon">${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'info' ? '‚ÑπÔ∏è' : '‚ö†Ô∏è'}</span>
              <span class="toast-message">${message}</span>
            </div>
          `;

          container.appendChild(toast);
          console.log('[showToast] appended toast:', message, 'type=', type);

          // Trigger CSS animation to show
          requestAnimationFrame(() => {
            toast.classList.add('show');
          });

          // Auto remove
          setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => {
              try {
                if (toast.parentElement) toast.parentElement.removeChild(toast);
              } catch (err) {
                console.warn('[showToast] failed to remove toast:', err);
              }
            }, 300);
          }, 3500);
        } catch (e) {
          // As a last resort, fallback to alert so user sees messages
          console.error('[showToast] error:', e);
          try {
            alert(message);
          } catch (__) {}
        }
      }

  // Savatcha badge-ni yangilash
  function updateCartCountDisplay() {
      fetch('/api/cart-count')
          .then(response => response.json())
          .then(data => {
              const badge = document.getElementById('cart-badge-floating'); // Ensure correct ID
              if (badge) {
                  if (data.count > 0) {
                      badge.textContent = data.count;
                      badge.classList.add('show');
                      badge.style.display = 'flex'; // Make sure it's visible
                  } else {
                      badge.classList.remove('show');
                      badge.style.display = 'none'; // Hide if count is 0
                  }
              }
          })
          .catch(error => {
              console.error('Cart count olishda xatolik:', error);
          });
  }

  // Handle form submission for add to cart
  function handleAddToCart(event, itemId) {
    event.preventDefault();

    const form = event.target;
    const quantityInput = form.querySelector('input[name="quantity"]');
    const quantity = quantityInput ? quantityInput.value : 1;

    // If the product has sizes/colors, open modal to force selection
    const item = menuData[itemId];
    if (item) {
      const hasSizes = (item.sizes || '').trim().length > 0;
      const hasColors = (item.colors || '').trim().length > 0;
      if (hasSizes || hasColors) {
        openItemModal(itemId);
        return false;
      }
    }

    addToCartAjax(itemId, quantity);
    return false; // Prevent default form submission
  }


  // NOTE: previous duplicate addToCartAjax removed. Use unified version above.

  // Savatcha qo'shilganda badge-ni yangilash
  // Form submit eventni tinglash va AJAX chaqiruvini o'rash
  document.querySelectorAll('form[action*="/add_to_cart"]').forEach(form => {
    form.addEventListener('submit', function(e) {
      e.preventDefault(); // Default submitni oldini olish
      const menuItemId = this.querySelector('input[name="menu_item_id"]').value;
      const quantityInput = this.querySelector('input[name="quantity"]');
      const quantity = quantityInput ? quantityInput.value : 1;
      // try to find inline size/color selects (for cards that include them)
      const sizeInput = this.querySelector('select[name="size"]') || this.querySelector('input[name="size"]');
      const colorInput = this.querySelector('select[name="color"]') || this.querySelector('input[name="color"]');
      const size = sizeInput ? sizeInput.value : '';
      const color = colorInput ? colorInput.value : '';

      // If product has options, force modal so user picks size/color
      const item = menuData[menuItemId];
      if (item) {
        const hasSizes = (item.sizes || '').trim().length > 0;
        const hasColors = (item.colors || '').trim().length > 0;
        if (hasSizes || hasColors) {
          openItemModal(menuItemId);
          return false;
        }
      }

      addToCartAjax(menuItemId, quantity, size, color);
    });
  });

  // Modal form submitni tinglash
  const modalCartForm = document.getElementById('modalCartForm');
  if (modalCartForm) {
    modalCartForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const menuItemId = document.getElementById('modalItemId').value;
      const quantity = document.getElementById('modalQuantity').value || 1;
      const size = document.getElementById('modalSize') ? document.getElementById('modalSize').value : '';
      const color = document.getElementById('modalColor') ? document.getElementById('modalColor').value : '';

      // Client validation: require selections when options exist
      const sizeSelect = document.getElementById('modalSize');
      const colorSelect = document.getElementById('modalColor');
      const hasSizes = sizeSelect && sizeSelect.options && sizeSelect.options.length > 1;
      const hasColors = colorSelect && colorSelect.options && colorSelect.options.length > 1;
      if ((hasSizes && !size) || (hasColors && !color)) {
        let msg = "Iltimos, ";
        const parts = [];
        if (hasSizes && !size) parts.push("o'lchamni tanlang");
        if (hasColors && !color) parts.push('rangni tanlang');
        msg += parts.join(' va ') + '.';
        showToast(msg, 'error');
        return false;
      }
      // Disable button to prevent duplicate clicks
      const addBtn = document.getElementById('modalAddToCartBtn');
      if (addBtn) {
        addBtn.disabled = true;
        addBtn.classList.add('disabled');
      }

      // Use the unified ajax; close modal only after success
      addToCartAjax(menuItemId, quantity, size, color)
        .then(result => {
          // server returned success via JSON; close on success
          if (result && result.success) {
            closeItemModal();
          } else {
            // Re-enable and show message
            if (addBtn) { addBtn.disabled = false; addBtn.classList.remove('disabled'); }
          }
        })
        .catch(err => {
          if (addBtn) { addBtn.disabled = false; addBtn.classList.remove('disabled'); }
        });
    });
  }


  // Color mapping for display names and indicators
  function getColorDisplayName(color) {
    const colorMap = {
      'black': 'üñ§ Qora',
      'white': 'ü§ç Oq',
      'blue': 'üíô Ko\'k',
      'red': '‚ù§Ô∏è Qizil',
      'green': 'üíö Yashil',
      'yellow': 'üíõ Sariq',
      'brown': 'ü§é Jigarrang',
      'gray': 'ü©∂ Kulrang',
      'grey': 'ü©∂ Kulrang',
      'pink': 'ü©∑ Pushti',
      'purple': 'üíú Binafsha',
      'orange': 'üß° Apelsin',
      'navy': 'üíô To\'q ko\'k',
      'maroon': '‚ù§Ô∏è To\'q qizil',
      'beige': 'ü§é Bej'
    };
    return colorMap[color.toLowerCase()] || `üé® ${color}`;
  }
  
  function getColorClass(color) {
    const colorMap = {
      'black': 'black',
      'white': 'white', 
      'blue': 'blue',
      'red': 'red',
      'green': 'green',
      'yellow': 'yellow',
      'brown': 'brown',
      'gray': 'gray',
      'grey': 'gray',
      'pink': 'pink',
      'purple': 'purple',
      'orange': 'orange',
      'navy': 'navy',
      'maroon': 'maroon',
      'beige': 'beige'
    };
    return colorMap[color.toLowerCase()] || 'gray';
  }
  
  function addColorIndicators(selectElement, colors) {
    // Create a custom dropdown wrapper
    const wrapper = selectElement.parentElement;
    let customDropdown = wrapper.querySelector('.custom-color-dropdown');
    
    if (customDropdown) {
      customDropdown.remove();
    }
    
    if (colors.length > 0) {
      customDropdown = document.createElement('div');
      customDropdown.className = 'custom-color-dropdown';
      customDropdown.style.cssText = `
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        max-height: 200px;
        overflow-y: auto;
        display: none;
      `;
      
      colors.forEach(color => {
        const option = document.createElement('div');
        option.className = 'color-option';
        option.style.cssText = `
          padding: 8px 12px;
          display: flex;
          align-items: center;
          gap: 8px;
          cursor: pointer;
          transition: all 0.2s ease;
        `;
        option.innerHTML = `
          <span class="color-indicator ${getColorClass(color)}"></span>
          <span>${getColorDisplayName(color)}</span>
        `;
        
        option.addEventListener('click', () => {
          selectElement.value = color;
          selectElement.dispatchEvent(new Event('change'));
          customDropdown.style.display = 'none';
        });
        
        customDropdown.appendChild(option);
      });
      
      wrapper.appendChild(customDropdown);
      
      // Toggle dropdown
      selectElement.addEventListener('click', (e) => {
        e.preventDefault();
        const isVisible = customDropdown.style.display === 'block';
        customDropdown.style.display = isVisible ? 'none' : 'block';
      });
      
      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!wrapper.contains(e.target)) {
          customDropdown.style.display = 'none';
        }
      });
    }
  }

  // Add missing keyframes animations
  const style = document.createElement('style');
  style.textContent = `
    /* Missing keyframe animations */
    @keyframes brandGlow {
      0% {
        text-shadow: 
          0 2px 4px rgba(0, 0, 0, 0.8),
          0 0 25px rgba(255, 102, 0, 0.8),
          0 0 35px rgba(255, 102, 0, 0.6);
      }
      100% {
        text-shadow: 
          0 2px 4px rgba(0, 0, 0, 0.8),
          0 0 35px rgba(255, 102, 0, 1),
          0 0 45px rgba(255, 102, 0, 0.8);
      }
    }
    
    @keyframes iconRotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    @keyframes iconWave {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-10deg); }
      75% { transform: rotate(10deg); }
    }
    
    @keyframes iconScale {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }
    
    @keyframes iconPulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }
    
    @keyframes premiumBadgePulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 4px 20px rgba(255, 102, 0, 0.5);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 0 6px 25px rgba(255, 102, 0, 0.7);
      }
    }
    
    @keyframes premiumShine {
      0% { transform: translateX(-200%); }
      100% { transform: translateX(200%); }
    }
    
    @keyframes checkGlow {
      0%, 100% {
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
        transform: scale(1);
      }
      50% {
        text-shadow: 0 0 15px rgba(255, 255, 255, 1);
        transform: scale(1.1);
      }
    }
    
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    @keyframes diamondSpin {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(180deg); }
    }
    
    @keyframes enhancedQualityFloat {
      0%, 100% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(-10px);
      }
    }
    
    @keyframes qualityShine {
      0% { left: -100%; }
      100% { left: 100%; }
    }
  `;
  document.head.appendChild(style);

  // Initialize the page
  document.addEventListener('DOMContentLoaded', function() {
    updateCartCountDisplay();
    loadMenuData();
  });
  
  
  // Helper function to create color dropdown for items
  function createColorDropdown(selectElement, wrapper, colors) {
    if (colors && colors.length > 0) {
      const customDropdown = document.createElement('div');
      customDropdown.className = 'custom-color-dropdown';
      customDropdown.style.cssText = `
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 2px solid #e2e8f0;
        border-top: none;
        border-radius: 0 0 12px 12px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      `;
      
      colors.forEach(color => {
        const option = document.createElement('div');
        option.className = 'color-option';
        option.style.cssText = `
          padding: 10px 12px;
          cursor: pointer;
          display: flex;
          align-items: center;
          gap: 10px;
          transition: background 0.2s ease;
        `;
        
        const indicator = document.createElement('div');
        indicator.className = `color-indicator ${getColorClass(color)}`;
        
        const text = document.createElement('span');
        text.textContent = getColorDisplayName(color);
        text.style.fontSize = '0.95rem';
        
        option.appendChild(indicator);
        option.appendChild(text);
        
        option.addEventListener('mouseenter', () => {
          option.style.background = '#f8fafc';
        });
        
        option.addEventListener('mouseleave', () => {
          option.style.background = 'transparent';
        });
        
        option.addEventListener('click', () => {
          selectElement.value = color;
          selectElement.dispatchEvent(new Event('change'));
          customDropdown.style.display = 'none';
        });
        
        customDropdown.appendChild(option);
      });
      
      wrapper.style.position = 'relative';
      wrapper.appendChild(customDropdown);
      
      // Show/hide custom dropdown
      selectElement.addEventListener('focus', () => {
        if (colors.length > 0) {
          customDropdown.style.display = 'block';
        }
      });
      
      selectElement.addEventListener('blur', (e) => {
        // Delay hiding to allow clicking on options
        setTimeout(() => {
          if (!customDropdown.contains(document.activeElement)) {
            customDropdown.style.display = 'none';
          }
        }, 200);
      });
    }
  }
  
  // Helper to set whether modal overlay is open and prevent body scroll
  function showItemModal() {
    const overlay = document.getElementById('itemModal');
    if (!overlay) return;
    overlay.style.display = 'flex';
    overlay.classList.add('show');
    document.body.style.overflow = 'hidden';
  }

  function hideItemModal() {
    const overlay = document.getElementById('itemModal');
    if (!overlay) return;
    overlay.style.display = 'none';
    overlay.classList.remove('show');
    document.body.style.overflow = 'auto';
  }

  /* NOTE: removed duplicate openItemModal/closeItemModal stubs so the
     main implementation (above) is used. The helpers `showItemModal`
     and `hideItemModal` are used by the main functions to centralize
     modal show/hide behavior. */

  // Baho berish modal
  let currentRatingItemId = null;
  let selectedMenuRating = 0;

  function openRatingModal(itemId, event) {
      event.stopPropagation();
      currentRatingItemId = itemId;

      const item = menuData[itemId];
      if (!item) return;

      // Rating modal yaratish
      const ratingModal = document.createElement('div');
      ratingModal.id = 'ratingModal';
      ratingModal.className = 'modal-overlay rating-modal';
      ratingModal.innerHTML = `
          <div class="rating-modal-content" onclick="event.stopPropagation()">
              <div class="rating-modal-header">
                  <h3>${item.name} uchun baho bering</h3>
                  <button class="modal-close" onclick="closeRatingModal()">‚úï</button>
              </div>
              <div class="rating-modal-body">
                  <div class="rating-item-info">
                      <img src="${item.image}" alt="${item.name}" class="rating-item-image">
                      <p class="rating-item-name">${item.name}</p>
                  </div>

                  <div class="rating-form">
                      <h4>Bahongizni bering:</h4>
                      <div class="stars-rating">
                          <span class="rating-star" data-rating="1">‚≠ê</span>
                          <span class="rating-star" data-rating="2">‚≠ê</span>
                          <span class="rating-star" data-rating="3">‚≠ê</span>
                          <span class="rating-star" data-rating="4">‚≠ê</span>
                          <span class="rating-star" data-rating="5">‚≠ê</span>
                      </div>
                      <textarea id="ratingComment" placeholder="Mahsulot haqida fikringizni yozing..." rows="4"></textarea>
                      <button onclick="submitRating()" class="btn-submit-rating" id="submit-rating" style="display: none;">
                          üìù Baho berish
                      </button>
                  </div>
              </div>
          </div>
      `;

      document.body.appendChild(ratingModal);
      ratingModal.style.display = 'flex';
      document.body.style.overflow = 'hidden';

      // Stars event listeners
      selectedMenuRating = 0;
      document.querySelectorAll('.rating-star').forEach(star => {
          star.addEventListener('click', function() {
              selectedMenuRating = parseInt(this.dataset.rating);
              updateRatingStars(selectedMenuRating);
              document.getElementById('submit-rating').style.display = 'block';
          });

          star.addEventListener('mouseover', function() {
              const rating = parseInt(this.dataset.rating);
              highlightRatingStars(rating);
          });
      });

      document.querySelector('.rating-form').addEventListener('mouseleave', function() {
          updateRatingStars(selectedMenuRating);
      });
  }

  function closeRatingModal() {
      const modal = document.getElementById('ratingModal');
      if (modal) {
          modal.remove();
          document.body.style.overflow = 'auto';
      }
      currentRatingItemId = null;
      selectedMenuRating = 0;
  }

  function highlightRatingStars(rating) {
      document.querySelectorAll('.rating-star').forEach((star, index) => {
          if (index < rating) {
              star.style.color = '#ffd700';
              star.style.transform = 'scale(1.2)';
          } else {
              star.style.color = '#ddd';
              star.style.transform = 'scale(1)';
          }
      });
  }

  function updateRatingStars(rating) {
      highlightRatingStars(rating);
  }

  function submitRating() {
      if (selectedMenuRating === 0) {
          showToast('Iltimos, baho tanlang!', 'warning');
          return;
      }

      const comment = document.getElementById('ratingComment').value.trim();

      fetch('/api/submit-rating', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json',
              'X-CSRF-Token': '{{ csrf_token }}'
          },
          body: JSON.stringify({
              menu_item_id: currentRatingItemId,
              rating: selectedMenuRating,
              comment: comment,
              csrf_token: '{{ csrf_token }}'
          })
      })
      .then(response => response.json())
      .then(data => {
          if (data.success) {
              showToast('Baho muvaffaqiyatli saqlandi! Rahmat!', 'success');
              closeRatingModal();
              // Sahifani yangilash
              setTimeout(() => {
                window.location.reload();
              }, 1500);
          } else {
              showToast('Xatolik: ' + (data.message || 'Noma\'lum xatolik'), 'error');
          }
      })
      .catch(error => {
          console.error('Error:', error);
          showToast('Baho berishda xatolik yuz berdi', 'error');
      });
    }

    // Mobile filter toggle function
    function toggleMobileFilter() {
      const sidebar = document.querySelector('.filter-sidebar');
      if (sidebar) {
        sidebar.classList.toggle('show');
      }
    }

    // Close mobile filter when clicking outside (for mobile)
    document.addEventListener('click', function(event) {
      const sidebar = document.querySelector('.filter-sidebar');
      const toggleBtn = document.querySelector('.mobile-filter-toggle');
      
      if (window.innerWidth <= 768 && sidebar && sidebar.classList.contains('show')) {
        if (!sidebar.contains(event.target) && !toggleBtn.contains(event.target)) {
          sidebar.classList.remove('show');
        }
      }
    });

    // Enhanced scroll behavior for fixed sidebar
    window.addEventListener('scroll', function() {
      const sidebar = document.querySelector('.filter-sidebar');
      if (sidebar && window.innerWidth > 768) {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        if (scrollTop > 50) {
          sidebar.style.top = '20px';
        } else {
          sidebar.style.top = '100px';
        }
      }
    });
</script>
{% endblock %}
