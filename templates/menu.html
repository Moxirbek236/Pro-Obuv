{% extends "base.html" %}

{% block content %}
<div class="card">
  <div class="text-center mb-4">
    <h2>ğŸ½ï¸ Restoran Menyusi</h2>
    <p class="muted">Eng mazali taomlarimizni tanlang va savatchaga qo'shing</p>
  </div>

  <div style="text-align: right; margin-bottom: 30px;">
    <a href="{{ url_for('cart') }}" class="cart-btn">
      ğŸ›’ Savatcha
      <span class="cart-badge" id="cart-count">0</span>
    </a>
  </div>

  <!-- Taomlar bo'limi -->
  <div class="menu-section">
    <h3>ğŸ² Taomlar</h3>
    <div class="menu-grid">
      {% for food in foods %}
      <div class="menu-item">
        <h4>{{ food.name }}</h4>
        <p class="price">{{ "{:,.0f}".format(food.price) }} so'm</p>
        <form method="post" action="{{ url_for('add_to_cart') }}" style="margin-top: 15px;">
          <input type="hidden" name="menu_item_id" value="{{ food.id }}">
          <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
            <div class="quantity-selector">
              <button type="button" class="quantity-btn minus" onclick="decreaseQuantity(this)">âˆ’</button>
              <input type="number" name="quantity" value="1" min="1" max="99" readonly>
              <button type="button" class="quantity-btn plus" onclick="increaseQuantity(this)">+</button>
            </div>
            <button type="submit" class="btn small">
              <span>ğŸ›’ Qo'shish</span>
            </button>
          </div>
        </form>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Ichimliklar bo'limi -->
  <div class="menu-section">
    <h3>ğŸ¥¤ Ichimliklar</h3>
    <div class="menu-grid">
      {% for drink in drinks %}
      <div class="menu-item">
        <h4>{{ drink.name }}</h4>
        <p class="price">{{ "{:,.0f}".format(drink.price) }} so'm</p>
        <form method="post" action="{{ url_for('add_to_cart') }}" style="margin-top: 15px;">
          <input type="hidden" name="menu_item_id" value="{{ drink.id }}">
          <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
            <div class="quantity-selector">
              <button type="button" class="quantity-btn minus" onclick="decreaseQuantity(this)">âˆ’</button>
              <input type="number" name="quantity" value="1" min="1" max="99" readonly>
              <button type="button" class="quantity-btn plus" onclick="increaseQuantity(this)">+</button>
            </div>
            <button type="submit" class="btn small">
              <span>ğŸ›’ Qo'shish</span>
            </button>
          </div>
        </form>
      </div>
      {% endfor %}
    </div>
  </div>

  {% if not foods and not drinks %}
  <div class="text-center p-3">
    <h4>ğŸ˜” Hozircha menyu bo'sh</h4>
    <p class="muted">Tez orada yangi taomlar qo'shiladi!</p>
  </div>
  {% endif %}
</div>

<div class="text-center mt-4">
  <a href="{{ url_for('cart') }}" class="btn big">
    ğŸ›’ Savatchani ko'rish
  </a>
</div>
{% endblock %}

{% block scripts %}
<script>
// Menu sahifasi uchun maxsus funksiyalar
document.addEventListener('DOMContentLoaded', function() {
    // Savatcha tugmasiga smooth scroll
    const cartButtons = document.querySelectorAll('a[href*="cart"]');
    cartButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            // Loading animatsiyasini qo'shish
            const icon = this.querySelector('span');
            if (icon) {
                icon.innerHTML = '<span class="loading"></span>';
            }
        });
    });

    // Form yuborilganda loading ko'rsatish
    const forms = document.querySelectorAll('form[action*="add_to_cart"]');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const submitBtn = this.querySelector('button[type="submit"]');
            if (submitBtn) {
                const span = submitBtn.querySelector('span');
                if (span) {
                    span.innerHTML = '<span class="loading"></span> Qo\'shilmoqda...';
                }
                submitBtn.disabled = true;
            }
        });
    });
});
</script>
</div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='main.js') }}"></script>
</body>
</html>