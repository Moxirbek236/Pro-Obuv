#!/usr/bin/env python3
"""
–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Pro-Obuv
–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è 100+ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
"""

import os
import sys
import warnings

# –û—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
warnings.filterwarnings("ignore")

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
os.environ.update({
    # Rate limiting - –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–µ –ª–∏–º–∏—Ç—ã
    "RATE_LIMIT_DAILY": "100000",
    "RATE_LIMIT_HOURLY": "10000", 
    "RATE_LIMIT_MINUTE": "1000",
    
    # Threading –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    "THREAD_POOL_MAX_WORKERS": "200",
    "DB_POOL_MAX_CONNECTIONS": "100",
    
    # –û—Ç–∫–ª—é—á–∞–µ–º —Ç—è–∂–µ–ª—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –¥–µ–º–æ
    "FLASK_ENV": "production",
    "LOG_LEVEL": "WARNING",
    
    # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
    "CACHE_TTL": "300",
})

sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

try:
    # –ò–º–ø–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    from app import app
    
    print("üöÄ –í–´–°–û–ö–û–ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–´–ô –†–ï–ñ–ò–ú –ê–ö–¢–ò–í–ò–†–û–í–ê–ù!")
    print("‚ö° –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è 100+ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")
    print("üî• Rate limits —É–≤–µ–ª–∏—á–µ–Ω—ã –≤ 20 —Ä–∞–∑")
    print("üí® –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤")
    print()
    print("üìä –ù–æ–≤—ã–µ –ª–∏–º–∏—Ç—ã:")
    print("  - 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É (–±—ã–ª–æ 50)")  
    print("  - 10000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —á–∞—Å (–±—ã–ª–æ 200)")
    print("  - 100000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å (–±—ã–ª–æ 1000)")
    print()
    print("üåê –î–æ—Å—Ç—É–ø:")
    print("  - –ì–ª–∞–≤–Ω–∞—è: http://127.0.0.1:5000")
    print("  - –ú–µ–Ω—é: http://127.0.0.1:5000/menu")
    print("  - API: http://127.0.0.1:5000/api")
    print()
    print("‚ö†Ô∏è  –ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏")
    print("=" * 50)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–æ—É—Ç–æ–≤
    route_count = len(list(app.url_map.iter_rules()))
    print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {route_count} —Ä–æ—É—Ç–æ–≤")
    print("‚úÖ –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞")
    print("‚úÖ –ì–æ—Ç–æ–≤ –∫ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ")
    print("=" * 50)
    
    # –ó–∞–ø—É—Å–∫ –≤ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ
    app.run(
        host='0.0.0.0',
        port=5000,
        debug=False,           # –í—ã–∫–ª—é—á–∞–µ–º debug –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
        use_reloader=False,    # –ë–µ–∑ reloader
        threaded=True,         # –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å
        processes=1,           # –û–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å –Ω–æ –º–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–æ–≤
        request_handler=None,  # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π handler
    )
    
except ImportError as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: {e}")
    print("\nüîß –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:")
    print("pip install flask flask-cors flask-compress flask-limiter")
    sys.exit(1)
    
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: {e}")
    import traceback
    traceback.print_exc()
    sys.exit(1)